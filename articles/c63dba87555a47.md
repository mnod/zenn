---
title: "KVM ãƒ©ã‚¤ãƒ–ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç·´ç¿’"
emoji: "ğŸ¦‡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["debian","kvm","libvirt"]
published: true
---

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ƒã®ç’°å¢ƒ

Debian10 ã§ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ƒã®ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

```
$ uname -a
Linux debian10 4.19.0-23-amd64 #1 SMP Debian 4.19.269-1 (2022-12-20) x86_64 GNU/Linux

$ cat /etc/os-release
PRETTY_NAME="Debian GNU/Linux 10 (buster)"
NAME="Debian GNU/Linux"
VERSION_ID="10"
VERSION="10 (buster)"
VERSION_CODENAME=buster
ID=debian
HOME_URL="https://www.debian.org/"
SUPPORT_URL="https://www.debian.org/support"
BUG_REPORT_URL="https://bugs.debian.org/"
```

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®æº–å‚™ã¨ã—ã¦ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ˆãƒ›ã‚¹ãƒˆåã«å¯¾ã—ã¦ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã²ã‘ã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚
```
# vi /etc/hosts
# grep 10.2.0.242 /etc/hosts
10.2.0.242      web1

```

ä»®æƒ³ãƒ–ãƒªãƒƒã‚¸ã¯ Open vSwitch ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
```
# apt install --no-install-recommends openvswitch-switch

# ovs-vsctl show
bb2b01e3-13a1-424e-a32f-453f7aa743bc
    ovs_version: "2.10.7"
```

åˆ©ç”¨ã™ã‚‹ä»®æƒ³ãƒ–ãƒªãƒƒã‚¸ ovsbr0 ã‚’ä½œæˆã—ã¾ã™ã€‚
ä¸‹è¨˜ã®å†…å®¹ã§ `/etc/network/interfaces` ã‚’ä½œæˆã—ã¾ã™ã€‚
```:/etc/network/interfaces
source /etc/network/interfaces.d/*
auto lo
iface lo inet loopback
auto ovsbr0
allow-ovs ovsbr0
iface ovsbr0 inet static
        ovs_type OVSBridge
        ovs_ports ens3
        address 10.2.0.241/24
        gateway 10.2.0.1
        dns-nameservers 192.168.11.249
allow-ovsbr0 ens3
iface ens3 inet manual
        ovs_bridge ovsbr0
        ovs_type OVSPort
```

networking ã‚’ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã—ã€çµæœã‚’ç¢ºèªã—ã¾ã™ã€‚
```
# systemctl restart networking

# ip a show ovsbr0
5: ovsbr0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UNKNOWN group default qlen 1000
    link/ether 22:c3:30:e6:23:4d brd ff:ff:ff:ff:ff:ff
    inet 10.2.0.241/24 brd 10.2.0.255 scope global ovsbr0
       valid_lft forever preferred_lft forever
    inet6 fe80::20c3:30ff:fee6:234d/64 scope link
       valid_lft forever preferred_lft forever
```

KVMã€Libvirt ã«é–¢é€£ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```
# apt install --no-install-recommends qemu-kvm qemu-utils libvirt-clients libvirt-daemon-system virtinst dnsmasq
```

ä»®æƒ³ãƒ–ãƒªãƒƒã‚¸ `ovsbr0` ã‚’ä½¿ç”¨ã™ã‚‹ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã—ã¾ã™ã€‚
ä»¥ä¸‹ã®å†…å®¹ã§ ovs.xml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
```:ovs.xml
<network>
  <name>ovs</name>
  <forward mode='bridge'/>
  <bridge name='ovsbr0'/>
  <virtualport type='openvswitch'/>
  <portgroup name='untag' default='yes'/>
  <portgroup name='vlan10'>
    <vlan>
      <tag id='10'/>
    </vlan>
  </portgroup>
</network>
```

ä»®æƒ³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã€èµ·å‹•ã—ã¦ã€çµæœã‚’ç¢ºèªã—ã¾ã™ã€‚
```
# virsh net-define ovs.xml
Network ovs defined from ovs.xml


# virsh net-start ovs
Network ovs started


# virsh net-list --all
 Name      State      Autostart   Persistent
----------------------------------------------
 default   inactive   no          yes
 ovs       active     no          yes

```

ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’æ ¼ç´ã™ã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ—ãƒ¼ãƒ« `nfs` ã‚’ä½œæˆã€èµ·å‹•ã—ã¦ã€çµæœã‚’ç¢ºèªã—ã¾ã™ã€‚
```
# virsh pool-define-as nfs dir --target /var/lib/libvirt/images/nfs
Pool nfs defined

# mkdir /var/lib/libvirt/images/nfs

# virsh pool-start nfs
Pool nfs started

# virsh pool-list --all
 Name   State    Autostart
----------------------------
 nfs    active   no

```

ä»®æƒ³ãƒã‚·ãƒ³ã‚’èµ·å‹•ã—ã¾ã™ã€‚
```
# virt-install --virt-type kvm --name rockylinux-old --cdrom /var/lib/libvirt/images/nfs/Rocky-9.1-x86_64-minimal.iso --os-variant rhel8-unknown --disk pool=nfs,size=10 --network network=ovs --memory 1024 --graphics vnc,listen=0.0.0.0,port=5900
WARNING  Unable to connect to graphical console: virt-viewer not installed. Please install the 'virt-viewer' package.
WARNING  No console to launch for the guest, defaulting to --wait -1

Starting install...
Allocating 'rockylinux-old.qcow2'                                                                                                                                                                                     |  10 GB  00:00:01
Domain installation still in progress. Waiting for installation to complete.
```

ä»®æƒ³ãƒã‚·ãƒ³ã‚’èµ·å‹•ã—ãŸçµæœã‚’ç¢ºèªã—ã¾ã™ã€‚
tap ãƒ‡ãƒã‚¤ã‚¹ãŒä½œæˆã•ã‚Œã¦ã€æ‰€å®šã®ãƒ–ãƒªãƒƒã‚¸ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã™ã€‚
```
# ovs-vsctl show
bb2b01e3-13a1-424e-a32f-453f7aa743bc
    Bridge "ovsbr0"
        Port "vnet0"
            Interface "vnet0"
        Port "ens3"
            Interface "ens3"
        Port "ovsbr0"
            Interface "ovsbr0"
                type: internal
    ovs_version: "2.10.7"

# ip link show vnet0
7: vnet0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master ovs-system state UNKNOWN mode DEFAULT group default qlen 1000
    link/ether fe:54:00:a2:df:75 brd ff:ff:ff:ff:ff:ff
```

æ‰€å®šã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ—ãƒ¼ãƒ«ã«ãƒœãƒªãƒ¥ãƒ¼ãƒ ãŒä½œæˆã•ã‚Œã¾ã™ã€‚
```
# virsh vol-list nfs
 Name                           Path
------------------------------------------------------------------------------------------
 Rocky-9.1-x86_64-minimal.iso   /var/lib/libvirt/images/nfs/Rocky-9.1-x86_64-minimal.iso
 rockylinux-old.qcow2           /var/lib/libvirt/images/nfs/rockylinux-old.qcow2

```


# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ˆã®ç’°å¢ƒ

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ˆã¨ãªã‚‹ç’°å¢ƒã¯ https://zenn.dev/mnod/articles/cade2dfb9dbd4d ã§ä½œæˆã—ãŸç’°å¢ƒã‚’å…ƒã¨ã—ã¾ã™ã€‚
ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ˆã§ã€ãƒ¦ãƒ¼ã‚¶ã‚’ libvirt ã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã—ã¾ã™ã€‚
```
# adduser user libvirt
Adding user `user' to group `libvirt' ...
Adding user user to group libvirt
Done.

# id user
uid=1000(user) gid=1000(user) groups=1000(user),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),116(libvirt)
```

ã¾ãŸã€å¿…è¦ã¨ãªã‚‹ ncat ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
```
# apt install --no-install-recommends ncat
```

ä¸Šè¨˜è¨­å®šã—ãŸã‚‰ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ƒã‹ã‚‰ä¸‹è¨˜ã®ã‚ˆã†ã«ã€virsh ã‚³ãƒãƒ³ãƒ‰ã§æ¥ç¶šã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
```
# virsh --connect qemu+ssh://user@10.2.0.242/system
user@10.2.0.242's password:
Welcome to virsh, the virtualization interactive terminal.

Type:  'help' for help with commands
       'quit' to quit


virsh # uri
qemu+ssh://user@10.2.0.242/system


virsh # list
 Id   Name         State
----------------------------
 2    rockylinux   running

```

# å…±æœ‰ãƒ‡ã‚£ã‚¹ã‚¯ã‚’åˆ©ç”¨ã™ã‚‹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

https://www.belbel.or.jp/opensuse-manuals_ja/cha-libvirt-managing.html

ã“ã“ã§ã¯ã€ç°¡å˜ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ã‚’ç›®æŒ‡ã—ã€æœ¬å½“ã®æ„å‘³ã§å…±æœ‰ãƒ‡ã‚£ã‚¹ã‚¯ã‚’åˆ©ç”¨ã™ã‚‹ã®ã§ã¯ãªãã€
ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ƒã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ nfs ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ˆã‚µãƒ¼ãƒã§ nfs ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ƒã®è¨­å®š

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ƒã‚µãƒ¼ãƒã§ nfs ã‚µãƒ¼ãƒã®è¨­å®šã‚’ã—ã¾ã™ã€‚
ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ—ãƒ¼ãƒ« `nfs` ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
```
# apt install --no-install-recommends nfs-kernel-server
```
```
# grep -v ^# /etc/exports
/var/lib/libvirt/images/nfs 10.2.0.0/24(rw,sync,no_root_squash)

# systemctl restart nfs-server
```

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ˆã®è¨­å®š

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ˆã‚µãƒ¼ãƒã§ nfs ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®šã‚’ã—ã¾ã™ã€‚
nfs ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚
```
# apt install --no-install-recommends nfs-common
# mkdir /var/lib/libvirt/images/nfs
# mount 10.2.0.241:/var/lib/libvirt/images/nfs /var/lib/libvirt/images/nfs
```

ãƒã‚¦ãƒ³ãƒˆã—ãŸã‚‰ã€æ›¸ãè¾¼ã¿ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
```
# touch /var/lib/libvirt/images/nfs/test

# ls -l /var/lib/libvirt/images/nfs/test
-rw-r--r-- 1 root root 0 Feb 14 17:48 /var/lib/libvirt/images/nfs/test

# rm /var/lib/libvirt/images/nfs/test

# ls -l /var/lib/libvirt/images/nfs
total 2967028
-rw-rw-r-- 1 root         root          1592590336 Feb  8 18:04 Rocky-9.1-x86_64-minimal.iso
-rw------- 1 libvirt-qemu libvirt-qemu 10739318784 Feb 14 16:48 rockylinux-old.qcow2
```

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ƒã¨åŒã˜ã‚ˆã†ã«ã€nfs ãƒã‚¦ãƒ³ãƒˆã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ©ç”¨ã™ã‚‹ `nfs` ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ—ãƒ¼ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
```
# virsh pool-list --all
 Name      State    Autostart
-------------------------------
 default   active   yes
 user      active   yes


# virsh pool-define-as nfs dir --target /var/lib/libvirt/images/nfs
Pool nfs defined


# virsh pool-list --all
 Name      State      Autostart
---------------------------------
 default   active     yes
 nfs       inactive   no
 user      active     yes


# virsh pool-start nfs
Pool nfs started


# virsh pool-list --all
 Name      State    Autostart
-------------------------------
 default   active   yes
 nfs       active   no
 user      active   yes


# virsh vol-list nfs
 Name                           Path
------------------------------------------------------------------------------------------
 Rocky-9.1-x86_64-minimal.iso   /var/lib/libvirt/images/nfs/Rocky-9.1-x86_64-minimal.iso
 rockylinux-old.qcow2           /var/lib/libvirt/images/nfs/rockylinux-old.qcow2

```

## ãƒ©ã‚¤ãƒ–ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ƒã§ã€ãƒ©ã‚¤ãƒ–ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¾ã™ã€‚
```
# virsh list
 Id   Name             State
--------------------------------
 3    rockylinux-old   running

# virsh -c qemu+ssh://user@10.2.0.242/system list
user@10.2.0.242's password:
 Id   Name         State
----------------------------
 2    rockylinux   running

# virsh migrate --live rockylinux-old --verbose qemu+ssh://user@10.2.0.242/system --persistent --undefinesource
user@10.2.0.242's password:
error: Unsafe migration: Migration without shared storage is unsafe

# virsh migrate --live rockylinux-old --verbose qemu+ssh://user@10.2.0.242/system --persistent --undefinesource --unsafe
user@10.2.0.242's password:
Migration: [100 %]

```

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†å¾Œã€çŠ¶æ…‹ã‚’ç¢ºèªã—ã¾ã™ã€‚
```
# virsh list --all
 Id   Name   State
--------------------


# virsh -c qemu+ssh://user@10.2.0.242/system list --all
user@10.2.0.242's password:
 Id   Name             State
--------------------------------
 2    rockylinux       running
 7    rockylinux-old   running


# virsh -c qemu+ssh://user@10.2.0.242/system dominfo rockylinux-old
user@10.2.0.242's password:
Id:             7
Name:           rockylinux-old
UUID:           20255981-157b-4408-a60c-5bfb206e1b43
OS Type:        hvm
State:          running
CPU(s):         1
CPU time:       3.0s
Max memory:     1048576 KiB
Used memory:    1048576 KiB
Persistent:     yes
Autostart:      disable
Managed save:   no
Security model: apparmor
Security DOI:   0
Security label: libvirt-20255981-157b-4408-a60c-5bfb206e1b43 (enforcing)

```

# ãƒ‡ã‚£ã‚¹ã‚¯ã‚³ãƒ”ãƒ¼ã«ã‚ˆã‚‹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ‡ã‚£ã‚¹ã‚¯ã‚³ãƒ”ãƒ¼æ–¹å¼ã§ã¯ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ—ãƒ¼ãƒ«ã®å…±æœ‰ã¯ä¸è¦ã§ã™ãŒã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ˆã§ã‚ã‚‰ã‹ã˜ã‚ç©ºã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ä½œæˆã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```
# virsh vol-create-as nfs rockylinux-old.qcow2 10GB --format qcow2 --allocation 0
Vol rockylinux-old.qcow2 created

# ls -l /var/lib/libvirt/images/nfs
total 196
-rw------- 1 root root 196760 Feb 15 14:57 rockylinux-old.qcow2

# virsh vol-list nfs
 Name                           Path
------------------------------------------------------------------------------------------
 Rocky-9.1-x86_64-minimal.iso   /var/lib/libvirt/images/nfs/Rocky-9.1-x86_64-minimal.iso
 rockylinux-old.qcow2           /var/lib/libvirt/images/nfs/rockylinux-old.qcow2

```

ä¸‹è¨˜ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¾ã™ã€‚ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã«å¿œã˜ã¦ã€ãã‚Œãªã‚Šã®æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚
```
# virsh migrate --live --copy-storage-all --persistent --verbose rockylinux-old qemu+ssh://user@10.2.0.242/system
```


# ç•°ãªã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ—ãƒ¼ãƒ«ã¸ã®ãƒ‡ã‚£ã‚¹ã‚¯ã‚³ãƒ”ãƒ¼

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ƒã¨å…ˆã¨ã§ç•°ãªã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ—ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã€
ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ƒã§ã€åˆ©ç”¨ã™ã‚‹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ—ãƒ¼ãƒ«ã‚’æŒ‡å®šã—ãŸ xml ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã—ã¾ã™ã€‚
```
# virsh dumpxml rockylinux-old > rockylinux-old.xml
# vi rockylinux-old.xml
# virsh dumpxml rockylinux-old | diff -u - rockylinux-old.xml
--- -   2023-02-15 15:46:27.282975938 -0500
+++ rockylinux-old.xml  2023-02-15 15:46:13.380385048 -0500
@@ -50,7 +50,7 @@
     <emulator>/usr/bin/qemu-system-x86_64</emulator>
     <disk type='file' device='disk'>
       <driver name='qemu' type='qcow2'/>
-      <source file='/var/lib/libvirt/images/nfs/rockylinux-old.qcow2'/>
+      <source file='/var/lib/libvirt/images/rockylinux-old.qcow2'/>
       <backingStore/>
       <target dev='hda' bus='ide'/>
       <alias name='ide0-0-0'/>
```

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ˆã§ã‚ã‚‰ã‹ã˜ã‚ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ä½œæˆã—ã¾ã™ã€‚
```
# virsh vol-create-as default rockylinux-old.qcow2 10GB --format qcow2 --allocation 0
Vol rockylinux-old.qcow2 created

# ls -l /var/lib/libvirt/images/rockylinux-old.qcow2
-rw------- 1 root root 196760 Feb 15 15:49 /var/lib/libvirt/images/rockylinux-old.qcow2

# virsh vol-list default
 Name                   Path
----------------------------------------------------------------------
 isos                   /var/lib/libvirt/images/isos
 rockylinux-old.qcow2   /var/lib/libvirt/images/rockylinux-old.qcow2
 rockylinux.qcow2       /var/lib/libvirt/images/rockylinux.qcow2

```

ä¸‹è¨˜ã®ã‚ˆã†ã«ã€ä½œæˆã—ãŸxmlãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¾ã™ã€‚
```
# virsh migrate --live --copy-storage-all --persistent --verbose --xml rockylinux-old.xml rockylinux-old qemu+ssh://user@10.2.0.242/system
```
