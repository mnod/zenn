---
title: "WebARENA Indigo ã® API ã‚’è©¦ã™"
emoji: "ğŸ¬"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["API"]
published: true
---

# ã¯ã˜ã‚ã«

æ ¼å®‰VPSã§ãŠãªã˜ã¿ã® [WebARENA Indigo](https://web.arena.ne.jp/indigo/) ã§ã¯ APIã§æ©Ÿèƒ½å‘¼ã³å‡ºã—ã§ãã‚‹ã€‚
ã“ã“ã§ã„ãã¤ã‹è©¦ã—ã¦ã¿ãŸã„ã€‚

# å‚è€ƒ

[APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://indigo.arena.ne.jp/userapi/)
[NTTPC Indigo ã§ OS ã‚’å…¥ã‚Œæ›¿ãˆã‚‹](https://scrapbox.io/otofune/NTTPC_Indigo_%E3%81%A7_OS_%E3%82%92%E5%85%A5%E3%82%8C%E6%9B%BF%E3%81%88%E3%82%8B)

# æº–å‚™

- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ã€ŒAPIéµã®ç®¡ç†ã€ã§ã€ŒAPIéµã®ä½œæˆã€ã‚’å®Ÿæ–½ã™ã‚‹ã€‚
- è¡¨ç¤ºã•ã‚Œã‚‹APIéµ ã¨ APIç§˜å¯†éµ ã‚’æ§ãˆã‚‹ã€‚(APIç§˜å¯†éµ ã¯2åº¦ã¨è¡¨ç¤ºã•ã‚Œãªã„ã€‚ç´›å¤±ã—ãŸã‚‰å‰Šé™¤ã—ã¦å†åº¦ä½œæˆã™ã‚‹ã€‚æ¼æ´©ã—ãŸã‚‰å‰Šé™¤ã—ã¦ä½œæˆã—ãªãŠã™)
- æ§ãˆãŸæƒ…å ±ã‚’ä»¥ä¸‹ã§ä¿å­˜
```:.webarenaindigo
IndigoApiPrivateKey=APIéµ
IndigoApiKey=APIç§˜å¯†éµ
```
- ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦èª­ã¿è¾¼ã‚€
```
chmod 600 .webarenaindigo
. .webarenaindigo
```

# [ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³](https://indigo.arena.ne.jp/userapi/#generate_access_token)

APIéµ ã¨ APIç§˜å¯†éµã‚’ã‚‚ã¨ã«ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹APIã€‚
ã“ã®ä»–ã®APIã¯ã€ã“ã“ã§å–å¾—ã—ãŸã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚Šèªè¨¼ã‚’è¡Œã†ã“ã¨ã«ãªã‚‹ã€‚

```
curl -s -X POST \
  https://api.customer.jp/oauth/v1/accesstokens\
  -H 'Content-Type: application/json' \
  -d '{
    "grantType": "client_credentials",
    "clientId": "'${IndigoApiKey}'",
    "clientSecret": "'${IndigoApiPrivateKey}'",
    "code": ""
}' | tee tmp | jq .
{
  "accessToken": "ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³",
  "tokenType": "BearerToken",
  "expiresIn": "3599",
  "scope": "",
  "issuedAt": "1728421337629"
}
```

`issuedAt` ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæƒ…å ±ã€‚
```
$ date --date @$(expr $(jq -r '.issuedAt' tmp) / 1000)
Tue Oct  8 21:02:17 UTC 2024
```

`expiresIn` ãŒç¤ºã™ã®ã¯ã€ãŠãã‚‰ã3600ç§’=1æ™‚é–“ã€‚

ä»¥ä¸‹ã§ã¯ã€ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ãŸ `tmp` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦ `jq -r .accessToken tmp` ã§ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã¦åˆ©ç”¨ã™ã‚‹ã€‚
ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ãŒæœŸé™åˆ‡ã‚Œã—ãŸã‚‰ã€åŒæ§˜ã«ã—ã¦å†å–å¾—ã™ã‚‹ã€‚

## python ã§ã®ä¾‹
Python3 ã® requests ã§ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹
```
>>> import os
>>> import requests
>>> import json
>>>
>>> IndigoApiKey = os.environ['IndigoApiKey']
>>> IndigoApiPrivateKey = os.environ['IndigoApiPrivateKey']
>>>
>>> url = 'https://api.customer.jp/oauth/v1/accesstokens'
>>> headers = {'Content-Type': 'application/json'}
>>> payload = {
...     "grantType": "client_credentials",
...     "clientId": IndigoApiKey,
...     "clientSecret": IndigoApiPrivateKey,
...     "code": ""
... }
>>>
>>> r = requests.post(url, data=json.dumps(payload), headers=headers)
>>>
>>> r.status_code
201
>>>
>>> r.headers
{'content-type': 'application/json', 'access-control-allow-origin': '*', 'access-control-allow-headers': 'origin, x-requested-with, accept, Authorization, Content-Type', 'access-control-max-age': '1728000', 'access-control-allow-methods': 'GET, PUT, POST, DELETE', 'x-request-id': '68bd3d18-b318-49d2-aa72-4d879ceb7563', 'Content-Length': '140', 'date': 'Thu, 10 Oct 2024 22:36:32 GMT', 'via': '1.1 google', 'Alt-Svc': 'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'}
>>>
>>> r.encoding
'utf-8'
>>>
>>> r.content
b'{"accessToken": "ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³", "tokenType": "BearerToken", "expiresIn": "3599" , "scope": "" , "issuedAt": "1728599792520"}'
>>>
>>> print(json.dumps(json.loads(r.text), indent=4))
{
    "accessToken": "ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³",
    "tokenType": "BearerToken",
    "expiresIn": "3599",
    "scope": "",
    "issuedAt": "1728599792520"
}
>>>
>>> print(json.dumps(r.json(), indent=2))
{
  "accessToken": "ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³",
  "tokenType": "BearerToken",
  "expiresIn": "3599",
  "scope": "",
  "issuedAt": "1728599792520"
}
>>>
>>> accesstoken = r.json().get("accessToken")
>>>
>>> print(accesstoken)
i4wFoE89bxrTUTsKQ49Lg1MGCQyi
>>>
```

# [SSH Key](https://indigo.arena.ne.jp/userapi/#ssh_keys)

VPSæ§‹ç¯‰æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸å…¥ã‚Œã‚‹SSHå…¬é–‹éµã‚’ç®¡ç†ã™ã‚‹

## ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ä¸€è¦§ã®å–å¾—

```
curl -s -X GET \
https://api.customer.jp/webarenaIndigo/v1/vm/sshkey \
-H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)''  | jq .
{
  "success": true,
  "total": 1,
  "sshkeys": [
    {
      "id": xxxx,
      "service_id": xxxx,
      "user_id": xxxx,
      "name": "sshkeyname",
      "sshkey": "ssh-rsa xxxx",
      "status": "ACTIVE",
      "created_at": "2022-05-20 13:57:39",
      "updated_at": "2022-05-20 13:57:39"
    }
  ]
}
```

Python ã‚’ä½¿ã£ã¦å–å¾—ã—ã¦ã¿ã‚‹ã€‚
```
>>> url = 'https://api.customer.jp/webarenaIndigo/v1/vm/sshkey'
>>>
>>> headers = {'Authorization': 'Bearer '+accesstoken }
ã¾ãŸã¯
>>> headers = {'Content-Type': 'application/json', 'Authorization': 'Bearer '+accesstoken }
ã©ã¡ã‚‰ã§ã‚‚ã„ã‘ãŸã€‚çµæœã¯å¤‰ã‚ã‚‰ãªã„
>>>
>>> r = requests.get(url, headers=headers)
>>>
>>> r.headers
{'date': 'Sat, 12 Oct 2024 10:42:12 GMT', 'vary': 'Authorization', 'cache-control': 'no-cache, private', 'severity': '200', 'x-content-type-options': 'nosniff', 'x-frame-options': 'sameorigin', 'x-xss-protection': '1; mode=block', 'strict-transport-security': 'max-age=631138519; includeSubDomains', 'Content-Length': '596', 'content-type': 'application/json', 'access-control-allow-origin': '*', 'access-control-allow-headers': 'origin, x-requested-with, accept, Authorization, Content-Type', 'access-control-max-age': '1728000', 'access-control-allow-methods': 'GET, PUT, POST, DELETE', 'x-request-id': '17bce742-8ce3-43c4-a865-f684830ad7e1', 'via': '1.1 google', 'Alt-Svc': 'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'}
>>>
>>> r.status_code
200
>>>
>>> r.encoding
'utf-8'
>>>
>>> r.content
b'{"success":true,"total":1,"sshkeys":[{"id":xxxx,"service_id":"xxxx","user_id":xxxx,"name":"arukas","sshkey":"ssh-rsa xxxx","status":"ACTIVE","created_at":"2022-05-20 13:57:39","updated_at":"2022-05-20 13:57:39"}]}'
>>>
```



## SSHå…¬é–‹éµã®ç™»éŒ²

æ‰‹æŒã¡ã®å…¬é–‹éµã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
```
curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/vm/sshkey \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{
   "sshName": "testsshkeyname",
   "sshKey": "ssh-rsa xxxx
  }' | jq .
{
  "success": true,
  "message": "SSH key has been added successfully",
  "sshKey": {
    "name": "testsshkeyname",
    "sshkey": "ssh-rsa xxxx,
    "status": "ACTIVE",
    "user_id": xxxx,
    "service_id": "idg-xxxx",
    "updated_at": "2024-10-11 22:01:18",
    "created_at": "2024-10-11 22:01:18",
    "id": 40277
  }
}
```

çµæœç¢ºèª
```
curl -s -X GET   https://api.customer.jp/webarenaIndigo/v1/vm/sshkey \
-H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)''  | jq '.sshkeys[] | select(.id == 40277)'
{
  "id": 40277,
  "service_id": "idg-xxxx",
  "user_id": xxxx,
  "name": "testsshkeyname",
  "sshkey": "ssh-rsa xxxx,
  "status": "ACTIVE",
  "created_at": "2024-10-11 22:01:18",
  "updated_at": "2024-10-11 22:01:18"
}
```

## ã‚­ãƒ¼æƒ…å ±æ›´æ–°

ã‚­ãƒ¼ã‚’ç„¡åŠ¹åŒ–ã—ã¦ã¿ãŸ
```
curl -s -X PUT \
  https://api.customer.jp/webarenaIndigo/v1/vm/sshkey/40277 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{
   "sshName": "testsshkeyname",
   "sshKey": "ssh-rsa xxxx,
   "sshKeyStatus": "DEACTIVE"
}' | jq .
{
  "success": true,
  "message": "SSH key has been updated successfully "
}
```

çµæœç¢ºèª
```
curl -s -X GET   https://api.customer.jp/webarenaIndigo/v1/vm/sshkey \
-H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)''  | jq '.sshkeys[] | select(.id == 40277)'
{
  "id": 40277,
  "service_id": "idg-xxxx",
  "user_id": xxxx,
  "name": "testsshkeyname",
  "sshkey": "ssh-rsa xxxx"id":xxxx,,
  "status": "DEACTIVE",
  "created_at": "2024-10-11 22:01:18",
  "updated_at": "2024-10-11 22:14:17"
}
```

## ã‚­ãƒ¼å‰Šé™¤
```
curl -s -X DELETE \
  https://api.customer.jp/webarenaIndigo/v1/vm/sshkey/40277 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "success": true,
  "message": "SSH key has been removed successfully"
}
```

# [APIã‚­ãƒ¼](https://indigo.arena.ne.jp/userapi/#api_key)

APIã‚’åˆ©ç”¨ã—ã¦ã€åˆ¥ã®APIéµ/APIç§˜å¯†éµã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

## æ–°è¦ç”Ÿæˆ

```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/auth/create/apikey \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "apiKey": "APIã‚­ãƒ¼",
  "apiSecret": "APIã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ"
}
```

ç¢ºèª
```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/auth/apikey \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq '.accesstokens[] | select(.id == 7574)'
{
  "id": 7574,
  "apiKey": "APIã‚­ãƒ¼",
  "created_at": "2024-10-08 23:22:50"
}
```

## å‰Šé™¤

```
curl -s -X DELETE \
  https://api.customer.jp/webarenaIndigo/v1/auth/apikey/7574 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "success": true,
  "message": "API Key is removed successfully"
}
```

# [ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹](https://indigo.arena.ne.jp/userapi/#instance_details)

## ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ä¸€è¦§

ç¾çŠ¶ä½¿ãˆã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ã¯ KVM Instance ã®ã¿ã€‚

```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/instancetypes \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "success": true,
  "total": 2,
  "instanceTypes": [
    {
      "id": 1,
      "name": "instance",
      "display_name": "KVM Instance",
      "created_at": "2019-10-09 13:11:20",
      "updated_at": "2019-10-09 13:11:20"
    },
    {
      "id": 2,
      "name": "microvps",
      "display_name": "MicroVPS",
      "created_at": "2019-10-09 13:11:20",
      "updated_at": "2019-10-09 13:11:20"
    }
  ]
}
```

## ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ä¸€è¦§

ç¾çŠ¶ä½¿ãˆã‚‹ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¯ Tokyo ã®ã¿ã€‚

```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/getregion?instanceTypeId=1 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "success": true,
  "total": 1,
  "regionlist": [
    {
      "id": 1,
      "oem_id": 1,
      "name": "Tokyo",
      "use_possible_date": "2019-10-03 23:07:19"
    }
  ]
}
```

```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/getregion?instanceTypeId=2 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "success": true,
  "total": 0,
  "regionlist": []
}
```

## OSã‚¿ã‚¤ãƒ—

```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/oslist?instanceTypeId=1 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "success": true,
  "total": 9,
  "osCategory": [
    {
      "id": 1,
      "name": "Ubuntu",
      "logo": "Ubudu.png",
      "osLists": [
        {
          "id": 1,
          "categoryid": 1,
          "code": "Ubuntu",
          "name": "Ubuntu18.04",
          "viewname": "Ubuntu 18.04",
          "instancetype_id": 1
        },
        {
          "id": 6,
          "categoryid": 1,
          "code": "Ubuntu",
          "name": "Ubuntu20.04",
          "viewname": "Ubuntu 20.04",
          "instancetype_id": 1
        },
        {
          "id": 13,
          "categoryid": 1,
          "code": "Ubuntu",
          "name": "Ubuntu22.04",
          "viewname": "Ubuntu 22.04",
          "instancetype_id": 1
        },
        {
          "id": 25,
          "categoryid": 1,
          "code": "Ubuntu",
          "name": "Ubuntu24.04",
          "viewname": "Ubuntu 24.04",
          "instancetype_id": 1
        }
      ]
    },
    {
      "id": 2,
      "name": "CentOS",
      "logo": "CentOS.png",
      "osLists": [
        {
          "id": 2,
          "categoryid": 2,
          "code": "CentOS",
          "name": "CentOS7.5",
          "viewname": "CentOS 7.5",
          "instancetype_id": 1
        },
        {
          "id": 5,
          "categoryid": 2,
          "code": "CentOS",
          "name": "CentOS8.1",
          "viewname": "CentOS 8.1",
          "instancetype_id": 1
        },
        {
          "id": 9,
          "categoryid": 2,
          "code": "CentOS",
          "name": "CentOS_Stream8",
          "viewname": "CentOS Stream8",
          "instancetype_id": 1
        },
        {
          "id": 14,
          "categoryid": 2,
          "code": "CentOS",
          "name": "CentOS_Stream9",
          "viewname": "CentOS Stream9",
          "instancetype_id": 1
        }
      ]
    },
    {
      "id": 3,
      "name": "Import VM",
      "logo": "ImportVm.png",
      "osLists": []
    },
    {                                                                                                                                                                                                                               [93/1964]
      "id": 4,
      "name": "Windows",
      "logo": "windows.png",
      "osLists": [
        {
          "id": 7,
          "categoryid": 4,
          "code": "WinOS",
          "name": "WindowsServer2019",
          "viewname": "Windows Server 2019 (no-RDS)",
          "instancetype_id": 1
        },
        {
          "id": 11,
          "categoryid": 4,
          "code": "WinOS",
          "name": "WindowsServer2022",
          "viewname": "Windows Server 2022 (no-RDS)",
          "instancetype_id": 1
        }
      ]
    },
    {
      "id": 5,
      "name": "Rocky",
      "logo": "Rocky.png",
      "osLists": [
        {
          "id": 10,
          "categoryid": 5,
          "code": "Rocky",
          "name": "RockyLinux8.4",
          "viewname": "Rocky Linux 8.4",
          "instancetype_id": 1
        },
        {
          "id": 19,
          "categoryid": 5,
          "code": "Rocky",
          "name": "RockyLinux9.0",
          "viewname": "Rocky Linux 9.0",
          "instancetype_id": 1
        },
        {
          "id": 23,
          "categoryid": 5,
          "code": "Rocky",
          "name": "RockyLinux9.3",
          "viewname": "Rocky Linux 9.3",
          "instancetype_id": 1
        }
      ]
    },
    {                                                                                                                                                                                                                               [39/1964]
      "id": 6,
      "name": "Oracle",
      "logo": "Oracle.png",
      "osLists": [
        {
          "id": 15,
          "categoryid": 6,
          "code": "Oracle",
          "name": "OracleLinux8.6",
          "viewname": "Oracle Linux 8.6",
          "instancetype_id": 1
        }
      ]
    },
    {
      "id": 7,
      "name": "Alma",
      "logo": "Alma.png",
      "osLists": [
        {
          "id": 16,
          "categoryid": 7,
          "code": "Alma",
          "name": "AlmaLinux8.6",
          "viewname": "AlmaLinux 8.6",
          "instancetype_id": 1
        },
        {
          "id": 17,
          "categoryid": 7,
          "code": "Alma",
          "name": "AlmaLinux9.0",
          "viewname": "AlmaLinux 9.0",
          "instancetype_id": 1
        },
        {
          "id": 24,
          "categoryid": 7,
          "code": "Alma",
          "name": "AlmaLinux9.3",
          "viewname": "AlmaLinux 9.3",
          "instancetype_id": 1
        }
      ]
    },
    {
      "id": 8,
      "name": "Debian",
      "logo": "Debian.png",
      "osLists": [
        {
          "id": 18,
          "categoryid": 8,
          "code": "Debian",
          "name": "Debian11",
          "viewname": "Debian 11",
          "instancetype_id": 1
        },
        {
          "id": 22,
          "categoryid": 8,
          "code": "Debian",
          "name": "Debian12",
          "viewname": "Debian 12",
          "instancetype_id": 1
        }
      ]
    },
    {
      "id": 9,
      "name": "KUSANAGI",
      "logo": "",
      "osLists": [
        {
          "id": 20,
          "categoryid": 9,
          "code": "KUSANAGI",
          "name": "KUSANAGI9_CentOS_Stream8",
          "viewname": "KUSANAGI 9 (CentOS Stream8)",
          "instancetype_id": 1
        },
        {
          "id": 21,
          "categoryid": 9,
          "code": "KUSANAGI",
          "name": "KUSANAGI9_CentOS_Stream9",
          "viewname": "KUSANAGI 9 (CentOS Stream9)",
          "instancetype_id": 1
        }
      ]
    }
  ]
}
```

```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/oslist?instanceTypeId=2 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "success": true,
  "total": 9,
  "osCategory": [
    {
      "id": 1,
      "name": "Ubuntu",
      "logo": "Ubudu.png",
      "osLists": []
    },
    {
      "id": 2,
      "name": "CentOS",
      "logo": "CentOS.png",
      "osLists": []
    },
    {
      "id": 3,
      "name": "Import VM",
      "logo": "ImportVm.png",
      "osLists": []
    },
    {
      "id": 4,
      "name": "Windows",
      "logo": "windows.png",
      "osLists": []
    },
    {
      "id": 5,
      "name": "Rocky",
      "logo": "Rocky.png",
      "osLists": []
    },
    {
      "id": 6,
      "name": "Oracle",
      "logo": "Oracle.png",
      "osLists": []
    },
    {
      "id": 7,
      "name": "Alma",
      "logo": "Alma.png",
      "osLists": []
    },
    {
      "id": 8,
      "name": "Debian",
      "logo": "Debian.png",
      "osLists": []
    },
    {
      "id": 9,
      "name": "KUSANAGI",
      "logo": "",
      "osLists": []
    }
  ]
}
```


## ã‚¹ãƒšãƒƒã‚¯

åˆ©ç”¨ã§ãã‚‹ã‚¹ãƒšãƒƒã‚¯ã¯ã€Linuxã‹Windowsã‹ã§ç•°ãªã‚‹ã€‚

Debian12ã®å ´åˆ
```
curl -s -X GET \
  'https://api.customer.jp/webarenaIndigo/v1/vm/getinstancespec?instanceTypeId=1&osId=22' \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "success": true,
  "total": 7,
  "speclist": [
    {
      "id": 1,
      "code": "1vCPU1GB20GB",
      "name": "Memory1GB,1vCPU,SSD20GB",
      "description": "<b>1</b> vCPU <br> <b>1 GB</b> RAM <br> <b>20 GB</b> SSD <br><b>100 </b> Mbps",
      "use_possible_date": "2019-10-03 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv46dual",
      "created_at": "2019-10-09 13:11:49",
      "updated_at": "2019-10-09 13:11:49",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 1,
        "plan_id": 1,
        "name": "1CR1GB",
        "param": "vcpus",
        "limitnum": 1
      }
    },
    {
      "id": 2,
      "code": "2vCPU2GB40GB",
      "name": "Memory2GB,2vCPU,SSD40GB",
      "description": "<b>2</b> vCPU <br> <b>2 GB</b> RAM <br> <b>40 GB</b> SSD <br><b>100 </b> Mbps",
      "use_possible_date": "2019-10-03 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv46dual",
      "created_at": "2019-10-09 13:11:49",
      "updated_at": "2019-10-09 13:11:49",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 8,
        "plan_id": 2,
        "name": "2CR2GB",
        "param": "vcpus",
        "limitnum": 2
      }
    },
    {                                                                                                                                                                                                                               [72/1835]
      "id": 3,
      "code": "4vCPU4GB80GB",
      "name": "Memory4GB,4vCPU,SSD80GB",
      "description": "<b>4</b> vCPU <br> <b>4 GB</b> RAM <br> <b>80 GB</b> SSD <br><b>500 </b> Mbps",
      "use_possible_date": "2019-11-19 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv46dual",
      "created_at": "2019-10-09 13:11:49",
      "updated_at": "2019-10-09 13:11:49",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 15,
        "plan_id": 3,
        "name": "4CR4GB",
        "param": "vcpus",
        "limitnum": 4
      }
    },
    {
      "id": 4,
      "code": "6vCPU8GB160GB",
      "name": "Memory8GB,6vCPU,SSD160GB",
      "description": "<b>6</b> vCPU <br> <b>8 GB</b> RAM <br> <b>160 GB</b> SSD <br><b>1000 </b> Mbps",
      "use_possible_date": "2019-11-19 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv46dual",
      "created_at": "2019-10-09 13:11:49",
      "updated_at": "2019-10-09 13:11:49",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 22,
        "plan_id": 4,
        "name": "6CR8GB",
        "param": "vcpus",
        "limitnum": 6
      }
    },
    {                                                                                                                                                                                                                               [22/1835]
      "id": 5,
      "code": "6vCPU16GB320GB",
      "name": "Memory16GB,6vCPU,SSD320GB",
      "description": "<b>6</b> vCPU <br> <b>16 GB</b> RAM <br> <b>320 GB</b> SSD <br><b>1000 </b> Mbps",
      "use_possible_date": "2020-04-22 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv46dual",
      "created_at": "2020-04-23 01:20:39",
      "updated_at": "2020-04-23 01:20:39",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 29,
        "plan_id": 5,
        "name": "6CR16GB",
        "param": "vcpus",
        "limitnum": 6
      }
    },
    {
      "id": 6,
      "code": "8vCPU32GB640GB",
      "name": "Memory32GB,8vCPU,SSD640GB",
      "description": "<b>8</b> vCPU <br> <b>32 GB</b> RAM <br> <b>640 GB</b> SSD <br><b>1000 </b> Mbps",
      "use_possible_date": "2020-04-22 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv46dual",
      "created_at": "2020-04-23 01:20:39",
      "updated_at": "2020-04-23 01:20:39",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 36,
        "plan_id": 6,
        "name": "8CR32GB",
        "param": "vcpus",
        "limitnum": 8
      }
    },
    {
      "id": 13,
      "code": "1vCPU768MB20GB",
      "name": "Memory768MB,1vCPU,SSD20GB",
      "description": "<b>1</b> vCPU <br> <b>768 MB</b> RAM <br> <b>20 GB</b> SSD <br><b>100 </b> Mbps",
      "use_possible_date": "2022-03-27 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv6",
      "created_at": "2022-03-28 05:05:16",
      "updated_at": "2022-03-28 05:05:16",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 85,
        "plan_id": 13,
        "name": "1CR768MB",
        "param": "vcpus",
        "limitnum": 1
      }
    }
  ]
}
```
```
curl -s -X GET \
  'https://api.customer.jp/webarenaIndigo/v1/vm/getinstancespec?instanceTypeId=2&osId=22' \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "success": true,
  "total": 0,
  "speclist": []
}
```

Windows2022ã®å ´åˆ
```
curl -s -X GET \
  'https://api.customer.jp/webarenaIndigo/v1/vm/getinstancespec?instanceTypeId=1&osId=11' \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "success": true,
  "total": 6,
  "speclist": [
    {
      "id": 7,
      "code": "2vCPU1GB50GB",
      "name": "Memory1GB,2vCPU,SSD50GB",
      "description": "<b>2</b> vCPU <br> <b>1 GB</b> RAM <br> <b>50 GB</b> SSD <br><b>100 </b> Mbps",
      "use_possible_date": "2020-10-14 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv4",
      "created_at": "2020-10-05 08:50:43",
      "updated_at": "2020-10-05 08:50:43",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 43,
        "plan_id": 7,
        "name": "2CR1GB",
        "param": "vcpus",
        "limitnum": 2
      }
    },
    {
      "id": 8,
      "code": "3vCPU2GB100GB",
      "name": "Memory2GB,3vCPU,SSD100GB",
      "description": "<b>3</b> vCPU <br> <b>2 GB</b> RAM <br> <b>100 GB</b> SSD <br><b>100 </b> Mbps",
      "use_possible_date": "2020-10-14 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv4",
      "created_at": "2020-10-05 08:50:44",
      "updated_at": "2020-10-05 08:50:44",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 50,
        "plan_id": 8,
        "name": "3CR2GB",
        "param": "vcpus",
        "limitnum": 3
      }
    },
    {                                                                                                                                                                                                                               [47/1845]
      "id": 9,
      "code": "4vCPU4GB200GB",
      "name": "Memory4GB,4vCPU,SSD200GB",
      "description": "<b>4</b> vCPU <br> <b>4 GB</b> RAM <br> <b>200 GB</b> SSD <br><b>500 </b> Mbps",
      "use_possible_date": "2020-10-14 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv4",
      "created_at": "2020-10-05 08:50:44",
      "updated_at": "2020-10-05 08:50:44",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 57,
        "plan_id": 9,
        "name": "4CR4GB",
        "param": "vcpus",
        "limitnum": 4
      }
    },
    {
      "id": 10,
      "code": "6vCPU8GB400GB",
      "name": "Memory8GB,6vCPU,SSD400GB",
      "description": "<b>6</b> vCPU <br> <b>8 GB</b> RAM <br> <b>400 GB</b> SSD <br><b>1000 </b> Mbps",
      "use_possible_date": "2020-10-14 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv4",
      "created_at": "2020-10-05 08:50:44",
      "updated_at": "2020-10-05 08:50:44",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 64,
        "plan_id": 10,
        "name": "6CR8GB",
        "param": "vcpus",
        "limitnum": 6
      }
    },
    {
      "id": 11,
      "code": "8vCPU16GB800GB",
      "name": "Memory16GB,8vCPU,SSD800GB",
      "description": "<b>8</b> vCPU <br> <b>16 GB</b> RAM <br> <b>800 GB</b> SSD <br><b>1000 </b> Mbps",
      "use_possible_date": "2020-10-14 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv4",
      "created_at": "2020-10-05 08:50:44",
      "updated_at": "2020-10-05 08:50:44",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 71,
        "plan_id": 11,
        "name": "8CR16GB",
        "param": "vcpus",
        "limitnum": 8
      }
    },
    {
      "id": 12,
      "code": "10vCPU32GB1600GB",
      "name": "Memory32GB,10vCPU,SSD1600GB",
      "description": "<b>10</b> vCPU <br> <b>32 GB</b> RAM <br> <b>1600 GB</b> SSD <br><b>1000 </b> Mbps",
      "use_possible_date": "2020-10-14 00:00:00",
      "instancetype_id": 1,
      "ipaddress_type": "ipv4",
      "created_at": "2020-10-05 08:50:45",
      "updated_at": "2020-10-05 08:50:45",
      "instance_type": {
        "id": 1,
        "name": "instance",
        "display_name": "KVM Instance",
        "created_at": "2019-10-09 13:11:20",
        "updated_at": "2019-10-09 13:11:20"
      },
      "kvm_resources": {
        "id": 78,
        "plan_id": 12,
        "name": "10CR32GB",
        "param": "vcpus",
        "limitnum": 10
      }
    }
  ]
}
```


```
curl -s -X GET \
  'https://api.customer.jp/webarenaIndigo/v1/vm/getinstancespec?instanceTypeId=2&osId=11' \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "success": true,
  "total": 0,
  "speclist": []
}
```

## ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ

```
curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/vm/createinstance \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{
  "sshKeyId": 21633,
  "regionId": 1,
  "osId": 22,
  "instancePlan": 13,
  "instanceName": "APItest"
}' | jq .
{
  "success": true,
  "message": "Instance has been created successfully",
  "vms": {
    "id": 616513,
    "instance_name": "APItest",
    "set_no": 18,
    "vps_kind": "10",
    "sequence_id": 616513,
    "user_id": xxxx,
    "service_id": "idg-xxxx",
    "status": "READY",
    "sshkey_id": 21633,
    "snapshot_id": 0,
    "created_at": {
      "date": "2024-10-09 20:26:06.875022",
      "timezone_type": 3,
      "timezone": "UTC"
    },
    "host_id": 191,
    "plan_id": 13,
    "plan": "1CR768MB",
    "disk_point": 0,
    "memsize": 0.768,
    "cpus": 1,
    "os_id": 22,
    "otherstatus": 10,
    "uuid": null,
    "uidgid": 626513,
    "vnc_port": 0,
    "vnc_passwd": "xxxx",
    "arpaname": null,
    "arpadate": 0,
    "started_at": null,
    "closed_at": null,
    "vm_revert": 0,
    "ipaddress": null,
    "secondary_ip": null,
    "macaddress": null,
    "instancetype_id": 1,
    "import_instance": 0,
    "container_id": null,
    "daemonstatus": "",
    "outofstock": 0,
    "ipaddress_type": "ipv6"
  }
}
```

ç¢ºèª
```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/getinstancelist \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq '.[] | select(.id == 616513)'
{
  "id": 616513,
  "instance_name": "APItest",
  "set_no": 18,
  "vps_kind": 10,
  "sequence_id": 616513,
  "user_id": xxxx,
  "service_id": "idg-xxxx",
  "status": "OPEN",
  "sshkey_id": 21633,
  "snapshot_id": 0,
  "created_at": "2024-10-09 20:26:06",
  "host_id": 191,
  "plan_id": 13,
  "plan": "1CR768MB",
  "disk_point": 0,
  "memsize": 0.768,
  "cpus": 1,
  "os_id": 22,
  "otherstatus": 20,
  "uuid": "UUID",
  "uidgid": 626513,
  "vnc_port": 11191,
  "vnc_passwd": "xxxx",
  "arpaname": "IPv6ã‚¢ãƒ‰ãƒ¬ã‚¹.pro.static.arena.ne.",
  "arpadate": 1728505630,
  "started_at": "2024-10-09 20:27:10",
  "closed_at": null,
  "vm_revert": 0,
  "ipaddress": "IPv6ã‚¢ãƒ‰ãƒ¬ã‚¹",
  "secondary_ip": "",
  "macaddress": "MACã‚¢ãƒ‰ãƒ¬ã‚¹",
  "instancetype_id": 1,
  "import_instance": 0,
  "container_id": null,
  "daemonstatus": "",
  "outofstock": 0,
  "ipaddress_type": "ipv6",
  "VEID": "18100000616513",
  "os": {
    "id": 22,
    "categoryid": 8,
    "code": "Debian",
    "name": "Debian12",
    "viewname": "Debian 12",
    "instancetype_id": 1
  },
  "ip": "IPv6ã‚¢ãƒ‰ãƒ¬ã‚¹",
  "instancecreatedbyuser": "____ ____ ",
  "regionname": "Tokyo",
  "instancestatus": "Stopped",
  "instancetype": {
    "id": 1,
    "name": "instance",
    "display_name": "KVM Instance",
    "created_at": "2019-10-09 13:11:20",
    "updated_at": "2019-10-09 13:11:20"
  }
}
```

ä½œæˆå¾Œã®çŠ¶æ…‹(instancestatus) ã¯ Stopped ãªã®ã§ã€åˆ©ç”¨ã™ã‚‹ã«ã¯èµ·å‹•ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

```
curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/vm/instance/statusupdate \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{"instanceId":"616513","status":"start"}' | jq .
{
  "success": true,
  "message": "Instance has started successfully ",
  "sucessCode": "I20008",
  "instanceStatus": "running"
}
```

## èµ·å‹•ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®åœæ­¢

WebARENA indigo ã§ã¯ã€åœæ­¢çŠ¶æ…‹ã§ã‚‚å‹•ã„ã¦ã„ã‚‹ã¨ãã¨åŒæ§˜ã®èª²é‡‘ã¨ãªã‚‹ã€‚

```
curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/vm/instance/statusupdate \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{"instanceId":"616513","status":"stop"}' | jq .
{
  "success": false,
  "message": "Shutdown of the instance is initiated. It will take few minutes to complete the shutdown process",
  "sucessCode": "I10025"
}
```

èª²é‡‘åœæ­¢ã™ã‚‹ã«ã¯ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å‰Šé™¤(destroy)ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

```
curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/vm/instance/statusupdate \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{"instanceId":"616513","status":"destroy"}' | jq .
{
  "success": true,
  "message": "Instance has been destroyed successfully",
  "sucessCode": "I20010",
  "instanceStatus": "shutoff"
}
```

ãªãŠã€stop ã™ã‚‹å‰ã« destroy ã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚destroy ã™ã‚‹å ´åˆã€ãã®å‰ã« stop ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

```
{
  "success": false,
  "errorMessage": "Instance is in running status. Please stop the instance before destroying.",
  "errorCode": "I10055"
}
```

## qcow2ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦VPSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ

ä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã€èµ·å‹•ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚‰ã—ã„ã€‚
(è‡ªåˆ†ã¯èµ·å‹•ã«æˆåŠŸã—ã¦ã„ãªã„ãŒ)

```
curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/vm/createinstance \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{
  "importUrl": "https://cloud.debian.org/images/cloud/bookworm/20241004-1890/debian-12-nocloud-ppc64el-20241004-1890.qcow2",
  "regionId": 1,
  "osId": 3,
  "instancePlan": 1,
  "instanceName": "ImportURLinstance"
}' | jq .
{
  "success": true,
  "message": "Instance has been created successfully",
  "vms": {
    "id": 618126,
    "instance_name": "ImportURLinstance",
    "set_no": 10,
    "vps_kind": "10",
    "sequence_id": 618126,
    "user_id": xxxx,
    "service_id": "idg-xxxx",
    "status": "READY",
    "sshkey_id": 0,
    "snapshot_id": 0,
    "created_at": {
      "date": "2024-10-11 20:16:33.939453",
      "timezone_type": 3,
      "timezone": "UTC"
    },
    "host_id": 6,
    "plan_id": 1,
    "plan": "1CR1GB",
    "disk_point": 0,
    "memsize": 1,
    "cpus": 1,
    "os_id": 3,
    "otherstatus": 10,
    "uuid": null,
    "uidgid": 628126,
    "vnc_port": 0,
    "vnc_passwd": "xxxx",
    "arpaname": null,
    "arpadate": 0,
    "started_at": null,
    "closed_at": null,
    "vm_revert": 0,
    "ipaddress": null,
    "secondary_ip": null,
    "macaddress": null,
    "instancetype_id": 1,
    "import_instance": 1,
    "container_id": null,
    "daemonstatus": "",
    "outofstock": 0,
    "ipaddress_type": "ipv46dual"
  }
}
```

åœ¨åº«ä¸è¶³ã®æ™‚ã¯ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚
```
{
  "success": false,
  "errorMessage": "Out of stock.",
  "errorCode": "I10059"
}
```

ä»¥ä¸‹ã®ã‚ˆã†ã«ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒå§‹ã¾ã‚‹ã€‚
```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/getinstancelist \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq '.[] | select(.id == 618126 )'

  "instancestatus": "Disk image download in-progress (5% Completed)",
```

ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ããªã„æ™‚ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹
```
  "instancestatus": "The URL entered is invalid.",
```

stop çŠ¶æ…‹ã§ä½œæˆã•ã‚Œã‚‹ã®ã§ start ã™ã‚‹ã€‚

è‡ªåˆ†ã¯OSèµ·å‹•ã¾ã§ã§ãã¦ã„ãªã„ã€‚
cloud-init ã® CDROMãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œãªã„ã¨ã‹ãªã‚“ã¨ã‹ã€‚
Webã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹è¨­å®šã‚’ã™ã‚Œã°ã„ã„ã®ã§ã¯ãªã„ã‹ã¨è€ƒãˆã¦ã„ã‚‹ã€‚

èµ·å‹•ã—ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ stop ã§åœæ­¢ã§ããªã„å ´åˆã€forcestop ã§åœæ­¢ã™ã‚‹ã€‚
åœæ­¢ã§ããŸã‚‰ destroy ã§å‰Šé™¤ã™ã‚‹ã€‚


# [FireWall](https://indigo.arena.ne.jp/userapi/#firewall)

## FWä½œæˆ
```
curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/nw/createfirewall \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{
    "name": "APItest",
    "inbound": [
        {"type": "HTTP", "protocol": "TCP","port":"80","source": "0.0.0.0"},
        {"type": "HTTPS", "protocol": "TCP","port":"443","source": "0.0.0.0"}
    ]
}' | jq .
{
  "success": true,
  "message": "Firewall template has been created successfully.",
  "sucessCode": "F60002",
  "firewallId": 12836
}
```

ç¢ºèª
```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/nw/gettemplate/12836 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq '.[]'
[
  {
    "id": 12836,
    "name": "APItest",
    "direction": "in",
    "type": "HTTP",
    "protocol": "TCP",
    "port": "80",
    "source": "0.0.0.0"
  },
  {
    "id": 12836,
    "name": "APItest",
    "direction": "in",
    "type": "HTTPS",
    "protocol": "TCP",
    "port": "443",
    "source": "0.0.0.0"
  }
]
```

## ä½œæˆã—ãŸFWã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«é©ç”¨

```
curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/nw/assign \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{
      "instanceid": "616516",
      "templateid": "12836"
}' | jq .
{
  "success": true,
  "message": "Firewall template is assigned successfully.",
  "sucessCode": "F60003"
}
```

## FWè¨­å®šå¤‰æ›´

ã“ã“ã§ã¯ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã¦ã„ã‚‹ã€‚

```
curl -s -X PUT \
  https://api.customer.jp/webarenaIndigo/v1/nw/updatefirewall \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{
    "templateid": "12836",
    "name": "APItest",
    "inbound": [
        {"type": "HTTP", "protocol": "TCP", "port": "80", "source": "0.0.0.0"},
        {"type": "HTTPS", "protocol": "TCP", "port": "443", "source": "0.0.0.0"},
        {"type": "Custom", "protocol": "TCP", "port": "22", "source": "'$(curl -s https://ddns.techjunk.net/getaddress/ | jq -r .sourceip)'"}
    ],
    "instances":["616516"]
}' | jq .
{
  "success": true,
  "message": "Firewall template is updated successfully.",
  "sucessCode": "F6004",
  "firewallId": "12836"
}
```

çµæœç¢ºèª
```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/nw/gettemplate/12836 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
[
  {
    "id": 12836,
    "name": "APItest",
    "direction": "in",
    "type": "HTTP",
    "protocol": "TCP",
    "port": "80",
    "source": "0.0.0.0"
  },
  {
    "id": 12836,
    "name": "APItest",
    "direction": "in",
    "type": "HTTPS",
    "protocol": "TCP",
    "port": "443",
    "source": "0.0.0.0"
  },
  {
    "id": 12836,
    "name": "APItest",
    "direction": "in",
    "type": "Custom",
    "protocol": "TCP",
    "port": "22",
    "source": "220.146.61.235"
  }
]
```

## FWå‰Šé™¤

ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç´ã¥ã‘ãŒã‚ã‚‹ã¨ã€FWå‰Šé™¤ã§ããªã„ã€‚
ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç´ã¥ã‘ã‚’å¤–ã™ã‹ã€ç´ã¥ã„ã¦ã„ã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰FWã‚’å‰Šé™¤ã™ã‚‹ã€‚
(ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç´ã¥ã‘ã‚’å¤–ã™APIãŒç„¡ã„ã‚ˆã†ã«æ€ã†)

```
curl -s -X DELETE \
  https://api.customer.jp/webarenaIndigo/v1/nw/deletefirewall/12836 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "success": true,
  "message": "Firewall template has been deleted successfully.",
  "sucessCode": "F6005"
}
```

ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç´ã¥ã‘ãŒã‚ã‚‹çŠ¶æ…‹ã§å‰Šé™¤ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚‹ã€‚
```
{
  "success": false,
  "errorMessage": "This firewall template has already been assigned to an active instance.",
  "errorCode": "F60009"
}
```

# [ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ](https://indigo.arena.ne.jp/userapi/#snapshot_intro)

## ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¸€è¦§

```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/disk/snapshotlist/616516 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
[]
```


## ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå–å¾—

```
curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/disk/takesnapshot \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{"name":"APItest", "instanceid":616516, "slotnum":"0"}' | jq .
{
  "STATUS": 0
}
```

çµæœç¢ºèªã€‚
```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/disk/snapshotlist/616516 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
[
  {
    "id": 12089,
    "name": "APItest",
    "service_id": "idg-xxxx",
    "user_id": "xxxx",
    "disk_id": xxxx,
    "volume": 12,
    "slot_number": 0,
    "status": "running",
    "size": "",
    "deleted": 0,
    "completed_timestamp": "0000-00-00 00:00:00",
    "deleted_timestamp": "0000-00-00 00:00:00"
  }
]
```

ä¿å­˜ãŒå®Œäº†ã™ã‚‹ã¨ã€status ãŒ running ã‹ã‚‰ created ã¸é·ç§»ã™ã‚‹ã€‚

```
[
  {
    "id": 12089,
    "name": "APItest",
    "service_id": "idg-xxxx",
    "user_id": "xxxx",
    "disk_id": xxxx,
    "volume": 12,
    "slot_number": 0,
    "status": "created",
    "size": "1071529984",
    "deleted": 0,
    "completed_timestamp": "2024-10-09 22:48:52",
    "deleted_timestamp": "0000-00-00 00:00:00"
  }
]
```

## ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰ã®æˆ»ã—

æœ€åˆã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åœæ­¢ã™ã‚‹
```
curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/vm/instance/statusupdate \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{"instanceId":"616516","status":"stop"}' | jq .
{
  "success": false,
  "message": "Shutdown of the instance is initiated. It will take few minutes to complete the shutdown process",
  "sucessCode": "I10025"
}
```

æ­¢ã¾ã£ãŸã“ã¨ã‚’ç¢ºèª
```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/vm/getinstancelist \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq '.[] | select(.id == 616516 ) | .instancestatus'
"Stopped"
```

æˆ»ã—å®Ÿè¡Œã€‚æˆ»ã—ãŸã‚‰ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ start ã™ã‚‹ã€‚
```
curl -s -X POST \
  https://api.customer.jp/webarenaIndigo/v1/disk/restoresnapshot \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' \
  -d '{"instanceid":"616516", "snapshotid":"12089"}' | jq .
{
  "STATUS": 0
}
```

å‚è€ƒã¾ã§ã«ã€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ­¢ã‚ãšã«æˆ»ã™ã¨ã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚
```
{
  "success": false,
  "errorMessage": "Please turn-off Instance before restoring a snapshot",
  "errorCode": "S10002"
}
```

## ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå‰Šé™¤

å‰Šé™¤
```
curl -s -X DELETE \
  https://api.customer.jp/webarenaIndigo/v1/disk/deletesnapshot/12089 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
{
  "STATUS": 0
}
```

ç¢ºèª
```
curl -s -X GET \
  https://api.customer.jp/webarenaIndigo/v1/disk/snapshotlist/616516 \
  -H 'Authorization: Bearer '$(jq -r ".accessToken" tmp)'' | jq .
[]
```


# ã¾ã¨ã‚çš„ãªãªã«ã‹

è‡ªåˆ†ãŒæ›¸ã„ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå‹•ã‹ãªããªã£ãŸã®ã§ã€æ”¹ã‚ã¦ç¢ºèªã—ã¦ã¿ãŸã‹ã£ãŸã®ãŒã€ã“ã®æŠ•ç¨¿ã‚’ä½œã£ãŸèƒŒæ™¯ã€‚

è‡ªå®…ã®ãƒ«ãƒ¼ã‚¿ã®å‹•çš„IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ã®FWãƒ«ãƒ¼ãƒ«å¤‰æ›´ã®è‡ªå‹•åŒ–ã¨ã‹ã€ç–é€šãŒãŠã‹ã—ããªã£ãŸã‚‰è‡ªå‹•çš„ã«OSå†èµ·å‹•ã¨ã‹ã€ã„ã‚ã„ã‚ä¾¿åˆ©ã«ä½¿ãˆã‚‹ã¨æ€ã†ã€‚
è‡ªå‹•åŒ–ã›ãšã¨ã‚‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆåŒ–ã—ã¦ãŠã‘ã°ã€ã‚ã–ã‚ã–ãƒ–ãƒ©ã‚¦ã‚¶é–‹ã„ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã‚³ãƒ³ãƒ‘ãƒé–‹ã„ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¾¿ã£ã¦æ“ä½œã—ãªãã¦ã‚‚ã„ã„ã®ã§ã€ä¾¿åˆ©ãªã®ã§ã¯ãªã‹ã‚ã†ã‹ã€‚

