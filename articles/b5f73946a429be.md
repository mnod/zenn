---
title: "ARMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤"
emoji: "ğŸ¦¾"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["azure"]
published: true
---

# ARMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤

`az deployment group` ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚Šã€ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ãƒ¬ãƒ™ãƒ«ã§ ARM ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚

- å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ --parametersã§æŒ‡å®šã™ã‚‹ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æŒ‡å®šãŒãªã„å ´åˆã€æ¨™æº–å…¥åŠ›ã§æŒ‡å®šã™ã‚‹ã€‚
- Increment ãƒ¢ãƒ¼ãƒ‰ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€‚ARMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ãªã„ãƒªã‚½ãƒ¼ã‚¹ã¯ã„ã˜ã‚‰ãªã„ã€‚Complete ãƒ¢ãƒ¼ãƒ‰ã‚’æŒ‡å®šã™ã‚‹ã¨ã€`az deployment group create` å®Ÿè¡Œæ™‚ã«ã€ ARMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ãªã„ãƒªã‚½ãƒ¼ã‚¹ã¯å‰Šé™¤ã•ã‚Œã‚‹ã€‚ä»¥ä¸‹ã§ã¯ Incrementãƒ¢ãƒ¼ãƒ‰ã®ãŠè©±ã—ã€‚
- ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å‰Šé™¤ã—ã¦ã‚‚ãƒªã‚½ãƒ¼ã‚¹ã¯å‰Šé™¤ã•ã‚Œãªã„ã€‚terraform destroyã®ã‚ˆã†ã«ã¯æŒ¯èˆã‚ãªã„ã€‚
- ãƒ‡ãƒ—ãƒ­ã‚¤ãŒä¸€éƒ¨å¤±æ•—ã™ã‚‹ã¨ã€æˆåŠŸã•ã‚ŒãŸåˆ†ã®ãƒªã‚½ãƒ¼ã‚¹ã®ã¿ä½œã‚‰ã‚Œã‚‹ã€‚å†ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã¨ã€æ–°ãŸã«ãƒªã‚½ãƒ¼ã‚¹ãŒè¿½åŠ ã•ã‚Œã‚‹

ãªãŠã€az ã‚³ãƒãƒ³ãƒ‰ã¯ `azure-cli` ã«å«ã¾ã‚Œã¦ãŠã‚Šã€è‡ªåˆ†ã¯ amazonlinux2 ã®ç’°å¢ƒã« `pip3 install azure-cli` ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã€‚

## ARMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä¾‹
    
### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ä¾‹

- defaultValue ã®æŒ‡å®šãŒã‚ã‚Œã°ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŒ‡å®šã‚’çœç•¥ã§ãã‚‹ã€‚
- ä¾å­˜é–¢ä¿‚ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ã‚ˆãã«ã¯ã‹ã‚‰ã£ã¦ãã‚Œãªã„ã€‚

@[gist](https://gist.github.com/mnod/0ed9ec48287d3a785a1e648911720b37?file=arm_template_vm_linux.template)

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹


@[gist](https://gist.github.com/mnod/0ed9ec48287d3a785a1e648911720b37?file=arm_template_vm_linux.parameters)

## äº‹å‰ç¢ºèª

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ¤œè¨¼

```
az deployment group validate --resource-group <ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å> --template-file <ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å> --parameters @<ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«å>
```

### äº‹å‰ç¢ºèª

å®Ÿéš›ã«ã©ã®ãƒªã‚½ãƒ¼ã‚¹ãŒæ§‹ç¯‰(å‰Šé™¤)ã•ã‚Œã‚‹ã‹äº‹å‰ç¢ºèªã™ã‚‹ã€‚terraform plan ã¿ãŸã„ãªæ„Ÿã˜ã€‚

```
az deployment group what-if --resource-group <ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å> --template-file <ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å> --parameters @<ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«å>
```

## ãƒ‡ãƒ—ãƒ­ã‚¤ã¨ç¢ºèª

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤

ãƒªã‚½ãƒ¼ã‚¹ã‚’æ§‹ç¯‰ã™ã‚‹
```
az deployment group create --name <ãƒ‡ãƒ—ãƒ­ã‚¤å> --resource-group <ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å> --template-file <ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å> --parameters @<ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«å>
```

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤ã®ç¢ºèª

```
az deployment group show --name <ãƒ‡ãƒ—ãƒ­ã‚¤å> --resource-group <ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å>
```

### ãƒªã‚½ãƒ¼ã‚¹IDã®ç¢ºèª

```
$ az deployment group show --resource-group "<ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å>" --name '<ãƒ‡ãƒ—ãƒ­ã‚¤å>' --query "properties.outputResources[].id"
```


## å¾Œç‰‡ä»˜ã‘

### ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤

```
$ resources=$(az deployment group show --resource-group "<ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å>" --name '<ãƒ‡ãƒ—ãƒ­ã‚¤å>' --query "properties.outputResources[].id" --output tsv)
$ az resource delete --ids $resources
```

### ãƒ‡ãƒ—ãƒ­ã‚¤ã®å‰Šé™¤

```
$ az deployment group delete --name <ãƒ‡ãƒ—ãƒ­ã‚¤å> --resource-group <ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å>
```

### å­˜åœ¨ã—ã¦ã„ã‚‹ãƒªã‚½ãƒ¼ã‚¹ã®ç¢ºèª

```
$ az vm list --query "[].id"
$ az network public-ip list --query "[].id"
$ az network nic list --query "[].id"
```

### ä¸è¦ãªãƒªã‚½ãƒ¼ã‚¹ã®å‰Šé™¤

```
$ az network nic delete -g <ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å> -n <NICå>
$ az network public-ip delete --ids /subscriptions/<ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ID>/resourceGroups/<ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—å>/providers/Microsoft.Network/publicIPAddresses/<ãƒ‘ãƒ–ãƒªãƒƒã‚¯IPã‚¢ãƒ‰ãƒ¬ã‚¹å>
```
