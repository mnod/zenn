---
title: "Debian11 „Åß LVM"
emoji: "üëú"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: ["lvm"]
published: true
---

# Ê∫ñÂÇô

## „Éë„Éº„ÉÜ„Ç£„Ç∑„Éß„É≥„ÅÆ‰ΩúÊàê

LVM„ÅßÂà©Áî®„Åô„Çã„Éë„Éº„ÉÜ„Ç£„Ç∑„Éß„É≥„ÇíÊ∫ñÂÇô„Åó„Åæ„Åô„ÄÇ
ÊúÄÂàù„Å´Âå∫Áîª„ÇíÂàá„Çä„Åæ„Åô„ÄÇ
```
# parted /dev/vdb print
Model: Virtio Block Device (virtblk)
Disk /dev/vdb: 4295MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  1418MB  1417MB  primary  ext4
 2      1418MB  2834MB  1417MB  primary


# parted /dev/vdb mkpart primary 66% 83%
Information: You may need to update /etc/fstab.


# parted /dev/vdb mkpart primary 83% 100%
Information: You may need to update /etc/fstab.


# parted /dev/vdb print
Model: Virtio Block Device (virtblk)
Disk /dev/vdb: 4295MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  1418MB  1417MB  primary  ext4
 2      1418MB  2834MB  1417MB  primary
 3      2834MB  3565MB  731MB   primary
 4      3565MB  4295MB  730MB   primary
```

Âàá„Å£„ÅüÂå∫Áîª„Å´„ÄÅLVM„Éï„É©„Ç∞„ÇíÁ´ã„Å¶„Åæ„Åô„ÄÇ
```
# parted /dev/vdb set 3 lvm on
Information: You may need to update /etc/fstab.


# parted /dev/vdb set 4 lvm on
Information: You may need to update /etc/fstab.


# parted /dev/vdb print
Model: Virtio Block Device (virtblk)
Disk /dev/vdb: 4295MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  1418MB  1417MB  primary  ext4
 2      1418MB  2834MB  1417MB  primary
 3      2834MB  3565MB  731MB   primary               lvm
 4      3565MB  4295MB  730MB   primary               lvm
```


## „Éë„ÉÉ„Ç±„Éº„Ç∏„Ç§„É≥„Çπ„Éà„Éº„É´

```
# apt install --no-install-recommends lvm2
```


# PV‰ΩúÊàê

```
# pvcreate /dev/vdb3
  Physical volume "/dev/vdb3" successfully created.

# pvcreate /dev/vdb4
  Physical volume "/dev/vdb4" successfully created.


# pvs
  PV         VG Fmt  Attr PSize   PFree
  /dev/vdb3     lvm2 ---  697.00m 697.00m
  /dev/vdb4     lvm2 ---  696.00m 696.00m

# pvdisplay
  "/dev/vdb3" is a new physical volume of "697.00 MiB"
  --- NEW Physical volume ---
  PV Name               /dev/vdb3
  VG Name
  PV Size               697.00 MiB
  Allocatable           NO
  PE Size               0
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               QkPFgM-XLay-1RN5-i36I-lfkE-40HT-GdJiKc

  "/dev/vdb4" is a new physical volume of "696.00 MiB"
  --- NEW Physical volume ---
  PV Name               /dev/vdb4
  VG Name
  PV Size               696.00 MiB
  Allocatable           NO
  PE Size               0
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               ysqn3Y-46Kk-bdOp-0Lw9-hj7O-hYVM-u12LfC
```

# VG‰ΩúÊàê

```
# vgcreate testvg /dev/vdb3
  Volume group "testvg" successfully created

# vgs
  VG     #PV #LV #SN Attr   VSize   VFree
  testvg   1   0   0 wz--n- 696.00m 696.00m

# vgdisplay
  --- Volume group ---
  VG Name               testvg
  System ID
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  1
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                0
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               696.00 MiB
  PE Size               4.00 MiB
  Total PE              174
  Alloc PE / Size       0 / 0
  Free  PE / Size       174 / 696.00 MiB
  VG UUID               1v3xXQ-3rHE-Gzdn-OG9S-Rkhu-dl6D-3UIp9k
```

# LV‰ΩúÊàê

LV„Çí‰ΩúÊàê„Åó„Å¶„ÄÅ„Éï„Ç°„Ç§„É´„Ç∑„Çπ„ÉÜ„É†„Çí‰Ωú„Çä„Åæ„Åô„ÄÇ
```
# lvcreate -L 256M -n testlv testvg
  Logical volume "testlv" created.

# lvs
  LV     VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  testlv testvg -wi-a----- 256.00m

# lvdisplay
  --- Logical volume ---
  LV Path                /dev/testvg/testlv
  LV Name                testlv
  VG Name                testvg
  LV UUID                sOuZOM-nh6J-TRDY-YEVA-bMig-FiT3-OfGrhX
  LV Write Access        read/write
  LV Creation host, time debian11-0, 2023-08-10 18:27:15 -0400
  LV Status              available
  # open                 0
  LV Size                256.00 MiB
  Current LE             64
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           253:0

# mkfs -t ext4 /dev/testvg/testlv
mke2fs 1.46.2 (28-Feb-2021)
Discarding device blocks: done
Creating filesystem with 262144 1k blocks and 65536 inodes
Filesystem UUID: 164b8a99-de45-49ac-8bd6-9e592960da28
Superblock backups stored on blocks:
        8193, 24577, 40961, 57345, 73729, 204801, 221185

Allocating group tables: done
Writing inode tables: done
Creating journal (8192 blocks): done
Writing superblocks and filesystem accounting information: done
```

# LVÊã°Âºµ

LV„ÇíÊã°Âºµ„Åó„Åü„Çâ„ÄÅ„Éï„Ç°„Ç§„É´„Ç∑„Çπ„ÉÜ„É†„ÇÇÊã°Âºµ„Åó„Åæ„Åô„ÄÇ
```
# lvextend -L +256MB /dev/testvg/testlv
  Size of logical volume testvg/testlv changed from 256.00 MiB (64 extents) to 512.00 MiB (128 extents).
  Logical volume testvg/testlv successfully resized.

# lvs
  LV     VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  testlv testvg -wi-a----- 512.00m

# lvdisplay
  --- Logical volume ---
  LV Path                /dev/testvg/testlv
  LV Name                testlv
  VG Name                testvg
  LV UUID                sOuZOM-nh6J-TRDY-YEVA-bMig-FiT3-OfGrhX
  LV Write Access        read/write
  LV Creation host, time debian11-0, 2023-08-10 18:27:15 -0400
  LV Status              available
  # open                 0
  LV Size                512.00 MiB
  Current LE             128
  Segments               1
  Allocation             inherit
  Read ahead sectors     auto
  - currently set to     256
  Block device           253:0

# fsck -f /dev/testvg/testlv
fsck from util-linux 2.36.1
e2fsck 1.46.2 (28-Feb-2021)
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/dev/mapper/testvg-testlv: 11/65536 files (0.0% non-contiguous), 18535/262144 blocks

# resize2fs /dev/testvg/testlv
resize2fs 1.46.2 (28-Feb-2021)
Resizing the filesystem on /dev/testvg/testlv to 524288 (1k) blocks.
The filesystem on /dev/testvg/testlv is now 524288 (1k) blocks long.
```

# LVÁ∏ÆÂ∞è

„Éï„Ç°„Ç§„É´„Ç∑„Çπ„ÉÜ„É†„ÇÇÁ∏ÆÂ∞è„Åó„Å¶„Åã„Çâ„ÄÅLV„ÇíÁ∏ÆÂ∞è„Åó„Åæ„Åô„ÄÇ
```
# fsck -f /dev/testvg/testlv
fsck from util-linux 2.36.1
e2fsck 1.46.2 (28-Feb-2021)
Pass 1: Checking inodes, blocks, and sizes
Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
/dev/mapper/testvg-testlv: 11/131072 files (0.0% non-contiguous), 27050/524288 blocks

# resize2fs /dev/testvg/testlv 384M
resize2fs 1.46.2 (28-Feb-2021)
Resizing the filesystem on /dev/testvg/testlv to 393216 (1k) blocks.
The filesystem on /dev/testvg/testlv is now 393216 (1k) blocks long.

# lvchange -an /dev/testvg/testlv

# lvs
  LV     VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  testlv testvg -wi------- 512.00m

# lvreduce -L -128M /dev/testvg/testlv
  Size of logical volume testvg/testlv changed from 512.00 MiB (128 extents) to 384.00 MiB (96 extents).
  Logical volume testvg/testlv successfully resized.

# lvchange -ay /dev/testvg/testlv

# lvs
  LV     VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  testlv testvg -wi-a----- 384.00m

# resize2fs /dev/testvg/testlv
resize2fs 1.46.2 (28-Feb-2021)
The filesystem is already 393216 (1k) blocks long.  Nothing to do!
```




# VGÊã°Âºµ

VG„Å´PV„ÇíËøΩÂä†„Åó„Å¶Êã°Âºµ„Åó„Åæ„Åô„ÄÇ

```
# vgdisplay
  --- Volume group ---
  VG Name               testvg
  System ID
  Format                lvm2
  Metadata Areas        1
  Metadata Sequence No  4
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               0
  Max PV                0
  Cur PV                1
  Act PV                1
  VG Size               696.00 MiB
  PE Size               4.00 MiB
  Total PE              174
  Alloc PE / Size       96 / 384.00 MiB
  Free  PE / Size       78 / 312.00 MiB
  VG UUID               1v3xXQ-3rHE-Gzdn-OG9S-Rkhu-dl6D-3UIp9k


# vgextend testvg /dev/vdb4
  Volume group "testvg" successfully extended

# vgdisplay
  --- Volume group ---
  VG Name               testvg
  System ID
  Format                lvm2
  Metadata Areas        2
  Metadata Sequence No  5
  VG Access             read/write
  VG Status             resizable
  MAX LV                0
  Cur LV                1
  Open LV               0
  Max PV                0
  Cur PV                2
  Act PV                2
  VG Size               <1.36 GiB
  PE Size               4.00 MiB
  Total PE              347
  Alloc PE / Size       96 / 384.00 MiB
  Free  PE / Size       251 / 1004.00 MiB
  VG UUID               1v3xXQ-3rHE-Gzdn-OG9S-Rkhu-dl6D-3UIp9k

# pvdisplay
  --- Physical volume ---
  PV Name               /dev/vdb3
  VG Name               testvg
  PV Size               697.00 MiB / not usable 0
  Allocatable           yes
  PE Size               4.00 MiB
  Total PE              174
  Free PE               78
  Allocated PE          96
  PV UUID               QkPFgM-XLay-1RN5-i36I-lfkE-40HT-GdJiKc

  --- Physical volume ---
  PV Name               /dev/vdb4
  VG Name               testvg
  PV Size               696.00 MiB / not usable 4.00 MiB
  Allocatable           yes
  PE Size               4.00 MiB
  Total PE              173
  Free PE               173
  Allocated PE          0
  PV UUID               ysqn3Y-46Kk-bdOp-0Lw9-hj7O-hYVM-u12LfC
```


# PE„ÅÆÁßªÂãï

PV /dev/vdb3 „ÅÆÂÜÖÂÆπ„Çí /dev/vdb4 „Å∏ÁßªÂãï„Åó„Åæ„Åô„ÄÇ

```
# pvdisplay
  --- Physical volume ---
  PV Name               /dev/vdb3
  VG Name               testvg
  PV Size               697.00 MiB / not usable 0
  Allocatable           yes
  PE Size               4.00 MiB
  Total PE              174
  Free PE               78
  Allocated PE          96
  PV UUID               QkPFgM-XLay-1RN5-i36I-lfkE-40HT-GdJiKc

  --- Physical volume ---
  PV Name               /dev/vdb4
  VG Name               testvg
  PV Size               696.00 MiB / not usable 4.00 MiB
  Allocatable           yes
  PE Size               4.00 MiB
  Total PE              173
  Free PE               173
  Allocated PE          0
  PV UUID               ysqn3Y-46Kk-bdOp-0Lw9-hj7O-hYVM-u12LfC

# pvmove /dev/vdb3
  /dev/vdb3: Moved: 1.04%
  /dev/vdb3: Moved: 100.00%

# pvdisplay
  --- Physical volume ---
  PV Name               /dev/vdb3
  VG Name               testvg
  PV Size               697.00 MiB / not usable 0
  Allocatable           yes
  PE Size               4.00 MiB
  Total PE              174
  Free PE               174
  Allocated PE          0
  PV UUID               QkPFgM-XLay-1RN5-i36I-lfkE-40HT-GdJiKc

  --- Physical volume ---
  PV Name               /dev/vdb4
  VG Name               testvg
  PV Size               696.00 MiB / not usable 4.00 MiB
  Allocatable           yes
  PE Size               4.00 MiB
  Total PE              173
  Free PE               77
  Allocated PE          96
  PV UUID               ysqn3Y-46Kk-bdOp-0Lw9-hj7O-hYVM-u12LfC
```

# VGÁ∏ÆÂ∞è

VG „Åã„Çâ PV„ÇíÂèñ„ÇäÈô§„ÅÑ„Å¶Á∏ÆÂ∞è„Åó„Åæ„Åô„ÄÇ

```
# pvdisplay
  --- Physical volume ---
  PV Name               /dev/vdb3
  VG Name               testvg
  PV Size               697.00 MiB / not usable 0
  Allocatable           yes
  PE Size               4.00 MiB
  Total PE              174
  Free PE               174
  Allocated PE          0
  PV UUID               QkPFgM-XLay-1RN5-i36I-lfkE-40HT-GdJiKc

  --- Physical volume ---
  PV Name               /dev/vdb4
  VG Name               testvg
  PV Size               696.00 MiB / not usable 4.00 MiB
  Allocatable           yes
  PE Size               4.00 MiB
  Total PE              173
  Free PE               77
  Allocated PE          96
  PV UUID               ysqn3Y-46Kk-bdOp-0Lw9-hj7O-hYVM-u12LfC


# vgreduce testvg /dev/vdb3
  Removed "/dev/vdb3" from volume group "testvg"

# pvdisplay
  --- Physical volume ---
  PV Name               /dev/vdb4
  VG Name               testvg
  PV Size               696.00 MiB / not usable 4.00 MiB
  Allocatable           yes
  PE Size               4.00 MiB
  Total PE              173
  Free PE               77
  Allocated PE          96
  PV UUID               ysqn3Y-46Kk-bdOp-0Lw9-hj7O-hYVM-u12LfC

  "/dev/vdb3" is a new physical volume of "697.00 MiB"
  --- NEW Physical volume ---
  PV Name               /dev/vdb3
  VG Name
  PV Size               697.00 MiB
  Allocatable           NO
  PE Size               0
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               QkPFgM-XLay-1RN5-i36I-lfkE-40HT-GdJiKc
```


# LVÂâäÈô§
```
# lvchange -an /dev/testvg/testlv

# lvs
  LV     VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  testlv testvg -wi------- 384.00m

# lvremove /dev/testvg/testlv
  Logical volume "testlv" successfully removed
```

# VGÂâäÈô§
```
# vgs
  VG     #PV #LV #SN Attr   VSize   VFree
  testvg   1   0   0 wz--n- 692.00m 692.00m

# vgremove testvg
  Volume group "testvg" successfully removed
```

# PVÂâäÈô§
```
# pvs
  PV         VG Fmt  Attr PSize   PFree
  /dev/vdb3     lvm2 ---  697.00m 697.00m
  /dev/vdb4     lvm2 ---  696.00m 696.00m

# pvremove /dev/vdb4
  Labels on physical volume "/dev/vdb4" successfully wiped.
```


# PV„ÅÆÊã°Âºµ

„Åæ„Åö„ÅØ„Éë„Éº„ÉÜ„Ç£„Ç∑„Éß„É≥„ÇíÊã°Âºµ„Åó„Åæ„Åô„ÄÇ
```
# parted /dev/vdb print
Model: Virtio Block Device (virtblk)
Disk /dev/vdb: 4295MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  1418MB  1417MB  primary  ext4
 2      1418MB  2834MB  1417MB  primary
 3      2834MB  3565MB  731MB   primary               lvm
 4      3565MB  4295MB  730MB   primary               lvm


# parted /dev/vdb rm 4 print
Model: Virtio Block Device (virtblk)
Disk /dev/vdb: 4295MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  1418MB  1417MB  primary  ext4
 2      1418MB  2834MB  1417MB  primary
 3      2834MB  3565MB  731MB   primary               lvm

Information: You may need to update /etc/fstab.


# parted /dev/vdb resizepart 3 100%
Information: You may need to update /etc/fstab.


# parted /dev/vdb print
Model: Virtio Block Device (virtblk)
Disk /dev/vdb: 4295MB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  1418MB  1417MB  primary  ext4
 2      1418MB  2834MB  1417MB  primary
 3      2834MB  4295MB  1461MB  primary               lvm
```

PV„ÇíÊã°Âºµ„Åó„Åæ„Åô„ÄÇ
```
# pvs
  PV         VG Fmt  Attr PSize   PFree
  /dev/vdb3     lvm2 ---  697.00m 697.00m

# pvdisplay
  "/dev/vdb3" is a new physical volume of "697.00 MiB"
  --- NEW Physical volume ---
  PV Name               /dev/vdb3
  VG Name
  PV Size               697.00 MiB
  Allocatable           NO
  PE Size               0
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               QkPFgM-XLay-1RN5-i36I-lfkE-40HT-GdJiKc

# pvresize /dev/vdb3
  Physical volume "/dev/vdb3" changed
  1 physical volume(s) resized or updated / 0 physical volume(s) not resized

# pvs
  PV         VG Fmt  Attr PSize PFree
  /dev/vdb3     lvm2 ---  1.36g 1.36g

# pvdisplay
  "/dev/vdb3" is a new physical volume of "1.36 GiB"
  --- NEW Physical volume ---
  PV Name               /dev/vdb3
  VG Name
  PV Size               1.36 GiB
  Allocatable           NO
  PE Size               0
  Total PE              0
  Free PE               0
  Allocated PE          0
  PV UUID               QkPFgM-XLay-1RN5-i36I-lfkE-40HT-GdJiKc

```

