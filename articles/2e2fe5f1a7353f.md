---
title: "ntp ã®ç·´ç¿’"
emoji: "ğŸ•°ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["cisco", "ccna", "dynamips", "dynagen", "ntp"]
published: true
---

# æœ¬ã‚¨ãƒ³ãƒˆãƒªã«ã¤ã„ã¦

Dynagenã€Dynamipsã€chronyd ã‚’ä½¿ã£ã¦ã€ntpè¨­å®šã‚’ç·´ç¿’ã—ã¾ã™ã€‚
Dynagenã€Dynamips ã®åˆ©ç”¨ç’°å¢ƒã¯ã™ã§ã«æ•´ã£ã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚

## å‚è€ƒ

https://www.cisco.com/c/dam/en/us/td/docs/ios-xml/ios/bsm/configuration/xe-3se/3650/bsm-xe-3se-3650-book.html
https://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus7000/sw/system-management/guide/b_Cisco_Nexus_7000_Series_NX-OS_System_Management_Configuration_Guide-RI/configuring_ntp.html
https://www.cisco.com/c/ja_jp/support/docs/ip/network-time-protocol-ntp/116161-trouble-ntp-00.html

## ç’°å¢ƒã«ã¤ã„ã¦

```mermaid
architecture-beta
    group pc0(cloud)[pc0]
    service ntpd(server)[ntpd] in pc0
    service br1(internet)[br1] in pc0
    service tap0(internet)[tap0] in pc0
    service r1(internet)[r1]
    service r2(internet)[r2]

    junction hub1
    junction hub1p1
    junction hub1p2

    junction hub2
    junction hub2p1
    junction hub2p2

    ntpd:T -- B:br1
    br1:R -- L:tap0
    tap0:R -- L:hub1
    hub1:R -- L:hub1p1
    hub1p1:B -- T:hub1p2
    hub1p1:R -- L:r1
    hub1p2:R -- L:r2

    r1:R -- L:hub2p1
    r2:R -- L:hub2p2
    hub2p1:B -- T:hub2p2
```

| device | interface | ip address | network address | comment |
| --- | ----  | ---           | --- | --- |
| pc0 | br1   | 10.2.0.1/24 | 10.2.0.0 | ntpã‚µãƒ¼ãƒ |
| r1  | fe0/0 | 10.2.0.254/24 |^ |  |
| r2  | fe0/0 | 10.2.0.253/24 |^ |  |

```:Dynagen è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æŠœç²‹
        [[ROUTER r1]]
                model = 3725
                console = 2001
                f0/0 = sw1 1
                f0/1 = sw1 4

        [[ROUTER r2]]
                model = 3725
                console = 2002
                f0/0 = sw1 2
                f0/1 = sw1 5

        [[ETHSW sw1]]
                1 = access 1
                2 = access 1
                3 = access 1 nio_tap:tap0
                4 = access 2
                5 = access 2
```

## ntp ã‚µãƒ¼ãƒåŸºæœ¬è¨­å®š

ntp ã‚µãƒ¼ãƒã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ chrony ã‚’åˆ©ç”¨ã—ã¾ã™ã®ã§ã€è¿½åŠ ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ã‚µãƒ¼ãƒã¨ã—ã¦å‹•ä½œã™ã‚‹ãŸã‚ã«å¿…è¦ãªæœ€ä½é™ã®è¨­å®šã¨ã—ã¦ã€æ™‚åˆ»æä¾›ã‚’è¨±å¯ã™ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹å¸¯ã®è¨­å®šã‚’è¿½åŠ ã—ã€ãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’å†èµ·å‹•ã—ã¾ã™ã€‚
```
$ sudo cp -pi /etc/chrony/chrony.conf{,.000}
$ sudo vi /etc/chrony/chrony.conf
$ diff -u /etc/chrony/chrony.conf{,.000}

@@ -29,5 +29,3 @@
 # Step the system clock instead of slewing it if the adjustment is larger than
 # one second, but only in the first three clock updates.
 makestep 1 3
-
-allow 10.2.0.0/16

$ sudo systemctl restart chrony
```

ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰æ™‚åˆ»åŒæœŸçŠ¶æ³ã‚’ç¢ºèªã—ã¾ã™ã€‚
åŒæœŸçŠ¶æ³ã‚’ç¤ºã™è¡Œã®ã€å…ˆé ­ã‹ã‚‰2æ–‡å­—ç›®ãŒ `*` ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
(æ™‚åˆ»åŒæœŸã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã¾ã™)
```
$ chronyc sources
210 Number of sources = 1
MS Name/IP address         Stratum Poll Reach LastRx Last sample
===============================================================================
^* 169.254.169.123               3   6   377    39    -30us[  -28us] +/-  443us
```

# Cisco ãƒ‡ãƒã‚¤ã‚¹å´å˜ä½“è¨­å®š

NTPã®ãƒ†ã‚¹ãƒˆã‚’å§‹ã‚ã‚‹å‰ã«ã€å˜ä½“ã§ã®æ™‚åˆ»è¨­å®šã‚’ã—ã¦ã¿ã¾ã™ã€‚

## æ™‚åˆ»ã®ç¢ºèª

ã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒ­ãƒƒã‚¯ã‚’ç¢ºèªã—ã¾ã™ã€‚
```
r1#show clock
*00:05:24.127 UTC Fri Mar 1 2002

r1#show clock detail
*00:05:28.275 UTC Fri Mar 1 2002
No time source
```

æ™‚åˆ»ã‚’è¨­å®šã—ã¦ã„ãªã„ã¨ã€æ™‚åˆ»ã®å…ˆé ­ã« `*` ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
å„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‡ºåŠ›ã®éš›ã«ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```
*Mar  1 00:00:05.495: %LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/1, changed state to up
```

## æ™‚åˆ»ã®è¨­å®š

è¨­å®šã™ã‚‹æ™‚åˆ»ã¯ `HH:MM:SS MMM DD YYYY` å½¢å¼ã§ `UTC` ã§æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
```
r1#clock set 04:54:00 Dec 22 2022

r1#show clock detail
04:54:07.099 UTC Thu Dec 22 2022
Time source is user configuration
```

æ™‚åˆ»ã‚’è¨­å®šã™ã‚‹ã¨ã€æ™‚åˆ»ã®å…ˆé ­ã® `*` ãŒãªããªã‚Šã¾ã™ã€‚
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‡ºåŠ›ã®éš›ã‚‚åŒæ§˜ã§ã™ã€‚

```
Dec 22 04:55:32.723: %SYS-5-CONFIG_I: Configured from console by console
```

## ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®è¨­å®š

ä¸‹è¨˜ã§ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’JSTã«è¨­å®šã—ã¾ã™ã€‚
```
r1(config)#clock timezone JST +9

r1#show clock detail
13:55:44.227 JST Thu Dec 22 2022
Time source is user configuration
```

# NTP ã«ã‚ˆã‚‹æ™‚åˆ»åŒæœŸ

æ™‚åˆ»åŒæœŸå…ˆã®NTPã‚µãƒ¼ãƒã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã—ã¾ã™ã€‚
```
r1(config)#ntp server 10.2.0.1
```

å°‘ã—å¾…ã£ã¦ã‹ã‚‰åŒæœŸçŠ¶æ³ã‚’ç¢ºèªã—ã¾ã™ã€‚
åŒæœŸçŠ¶æ³ã‚’ç¤ºã™è¡Œã®å…ˆé ­ã« `*` ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãŸã‚‰ã€æ­£å¸¸ã«æ™‚åˆ»ãŒåŒæœŸã•ã‚Œã¦ã„ã¾ã™ã€‚

```
r1#show ntp associations

      address         ref clock     st  when  poll reach  delay  offset    disp
*~10.2.0.1         169.254.169.123   4     0    64    1    29.0    5.54     5.5
 * master (synced), # master (unsynced), + selected, - candidate, ~ configured

r1#show ntp status
Clock is synchronized, stratum 5, reference is 10.2.0.1
nominal freq is 250.0000 Hz, actual freq is 250.0000 Hz, precision is 2**18
reference time is E74C95FB.0C472F2E (05:13:47.047 JST Wed Dec 21 2022)
clock offset is -7.0836 msec, root delay is 1.83 msec
root dispersion is 16.75 msec, peer dispersion is 9.38 msec

r1#show clock detail
05:14:58.354 JST Wed Dec 21 2022
Time source is NTP
```

ãªãŠã€`debug ntp events` ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€åŒæœŸé–‹å§‹æ™‚ã«ä»¥ä¸‹ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚
```
*Mar  1 00:02:37.035: NTP: 10.2.0.1 unreachable
*Dec 29 20:23:07.714: NTP: peer stratum change
*Dec 29 20:23:07.714: NTP: clock reset
```

ã“ã®ã¨ãã¯ä¸‹è¨˜ã®çŠ¶æ…‹ã«ãªã£ã¦ã„ã¾ã™ã€‚
```
sw01#show ntp associations

      address         ref clock     st  when  poll reach  delay  offset    disp
 ~10.2.0.1         169.254.169.123   4    23    64    0    25.4  657404  16000.
 * master (synced), # master (unsynced), + selected, - candidate, ~ configured

sw01#show clock detail
.20:23:35.402 UTC Thu Dec 29 2022
Time source is NTP
```

ãã®å¾Œã€åŒæœŸãŒå®Œäº†ã™ã‚‹ã¨ä»¥ä¸‹ã® debug ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚
```
Dec 29 20:24:11.714: NTP: 10.2.0.1 synced to new peer
Dec 29 20:24:11.714: NTP: sync change
Dec 29 20:24:11.714: NTP: peer stratum change
Dec 29 20:24:11.714: NTP: 10.2.0.1 reachable
```

# éµã«ã‚ˆã‚‹èªè¨¼

éµã«ã‚ˆã‚‹èªè¨¼ã§ã¯ã€NTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒä¿¡é ¼ã§ãã‚‹NTPã‚µãƒ¼ãƒã«å¯¾ã—ã¦ã®ã¿æ™‚åˆ»åŒæœŸã‚’é™å®šã—ã¾ã™ã€‚
(NTPã‚µãƒ¼ãƒãŒæ™‚åˆ»åŒæœŸã‚’è¨±å¯ã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆ¶é™ã™ã‚‹ã‚ˆã†ãªã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“)

## ntp ã‚µãƒ¼ãƒè¨­å®š

æœ€åˆã«ã€NTPã‚µãƒ¼ãƒå´ã§ keyfile ã«éµã‚’ç™»éŒ²ã—ã¾ã™ã€‚
```
$ grep keyfile /etc/chrony/chrony.conf
keyfile /etc/chrony/chrony.keys

$ sudo cp -pi /etc/chrony/chrony.keys{,.000}
$ sudo vi /etc/chrony/chrony.keys
$ sudo diff -u /etc/chrony/chrony.keys{,.000}

@@ -8,4 +8,3 @@
 #
 # A list of supported hash functions and output encoding can be found in
 # the "keyfile" section from the "/usr/share/doc/chrony/chrony.txt.gz" file.
-10 cisco

$ sudo systemctl restart chrony
```

## Ciscoãƒ‡ãƒã‚¤ã‚¹è¨­å®š

r1 ã®æ™‚åˆ»åŒæœŸå…ƒã‚’ ntp server ã¨ã™ã‚‹è¨­å®šã‚’ã—ã¾ã™ã€‚
```
r1(config)#ntp authenticate
r1(config)#ntp authentication-key 10 md5 cisco
r1(config)#ntp trusted-key 10
r1(config)#ntp server 10.2.0.1 key 10
```

åŒæœŸçŠ¶æ³ã‚’ç¢ºèªã—ã¾ã™ã€‚
ã¾ãŸ `show ntp associations detail` ã®1è¡Œç›®ã« `authenticated` ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
```
r1#show ntp associations

      address         ref clock     st  when  poll reach  delay  offset    disp
*~10.2.0.1         169.254.169.123   4     0    64  377    10.6   -2.54     3.5
 * master (synced), # master (unsynced), + selected, - candidate, ~ configured

r1#show ntp associations detail
10.2.0.1 configured, authenticated, our_master, sane, valid, stratum 4
ref ID 169.254.169.123, time E74D6CD1.860BC208 (20:30:25.523 JST Wed Dec 21 2022)
our mode client, peer mode server, our poll intvl 64, peer poll intvl 64
root delay 0.32 msec, root disp 0.31, reach 377, sync dist 7.843
delay 9.83 msec, offset 0.0250 msec, dispersion 2.47
precision 2**25, version 3
org time E74D6CD5.8E818541 (20:30:29.556 JST Wed Dec 21 2022)
rcv time E74D6CD5.91083C7F (20:30:29.566 JST Wed Dec 21 2022)
xmt time E74D6CD5.8CFACA9C (20:30:29.550 JST Wed Dec 21 2022)
filtdelay =    15.61   18.52    9.83   20.83   15.95   31.94   10.59   33.48
filtoffset =   -2.06    4.66    0.03    3.44    0.36    8.48   -2.54    8.42
filterror =     0.02    0.03    0.05    0.06    0.08    0.09    0.11    0.12
```

ä»Šåº¦ã¯ r2 ã®æ™‚åˆ»åŒæœŸå…ƒã‚’ r1 ã¨ã™ã‚‹è¨­å®šã‚’ã—ã¦ã¿ã¾ã™ã€‚
```
r2(config)#ntp authenticate
r2(config)#ntp authentication-key 10 md5 cisco
r2(config)#ntp trusted-key 10
r2(config)#ntp server 10.2.0.254 key 10
```

çµæœã‚’ç¢ºèªã—ã¾ã™ã€‚
```
r2#show ntp associations

      address         ref clock     st  when  poll reach  delay  offset    disp
*~10.2.0.254       10.2.0.1          5     0    64    3    11.9    7.94  7878.1
 * master (synced), # master (unsynced), + selected, - candidate, ~ configured

r2#show ntp associations detail
10.2.0.254 configured, authenticated, our_master, sane, valid, stratum 5
ref ID 10.2.0.1, time E74D6F59.92BBA3FB (11:41:13.573 UTC Wed Dec 21 2022)
our mode client, peer mode server, our poll intvl 64, peer poll intvl 64
root delay 8.13 msec, root disp 10.22, reach 77, sync dist 406.281
delay 11.89 msec, offset 7.9434 msec, dispersion 386.05
precision 2**18, version 3
org time E74D6F8B.9A8EB4F3 (11:42:03.603 UTC Wed Dec 21 2022)
rcv time E74D6F8B.9E351098 (11:42:03.617 UTC Wed Dec 21 2022)
xmt time E74D6F8B.9A19202F (11:42:03.601 UTC Wed Dec 21 2022)
filtdelay =    12.12   35.69   31.98   23.90   31.91   11.89    0.00    0.00
filtoffset =   -8.19   16.00    1.88    1.94    1.81    7.94    0.00    0.00
filterror =     0.02    0.03    0.05    0.06    0.08    0.09 16000.0 16000.0
```

# ãƒ”ã‚¢è¨­å®š

r1 ã¨ r2ã‚’ ntp server ã¨åŒæœŸã•ã›ã¦ã‚‹çŠ¶æ³ã§ã€r1 ã¨ r2ã‚’ ãƒ”ã‚¢è¨­å®šã—ã¦ã¿ã¾ã™ã€‚

ã¾ãšã¯ r1 ã®è¨­å®šã§ã™ã€‚
```
r1#show ntp associations

      address         ref clock     st  when  poll reach  delay  offset    disp
*~10.2.0.1         169.254.169.123   4    80   128  377    12.1    2.90     3.3
 * master (synced), # master (unsynced), + selected, - candidate, ~ configured

r1(config)#ntp peer 10.2.0.253 key 10

r1#show ntp associations

      address         ref clock     st  when  poll reach  delay  offset    disp
*~10.2.0.1         169.254.169.123   4   116   128  377    12.1    2.90     3.3
+~10.2.0.253       10.2.0.1          5     0   128   77    19.8  -22.39   380.6
 * master (synced), # master (unsynced), + selected, - candidate, ~ configured
```

äº’ã„ã«ãƒ”ã‚¢è¨­å®šã‚’çµ‚ãˆã¦ã‹ã‚‰ç¢ºèªã™ã‚‹ã¨ä¸‹è¨˜ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
```
r1#show ntp associations detail
10.2.0.1 configured, authenticated, our_master, sane, valid, stratum 4
ref ID 169.254.169.123, time E74D73A1.B662FE89 (20:59:29.712 JST Wed Dec 21 2022)
our mode client, peer mode server, our poll intvl 128, peer poll intvl 128
root delay 0.37 msec, root disp 0.46, reach 377, sync dist 17.365
delay 12.05 msec, offset 2.9012 msec, dispersion 10.70
precision 2**25, version 3
org time E74D7451.924EE6F8 (21:02:25.571 JST Wed Dec 21 2022)
rcv time E74D7451.93AA0671 (21:02:25.576 JST Wed Dec 21 2022)
xmt time E74D7451.8C7E9D46 (21:02:25.548 JST Wed Dec 21 2022)
filtdelay =    27.92   31.89   26.38   12.05   12.99   25.70    6.07   37.40
filtoffset =    8.67   10.82    6.27    2.90    1.23    8.15   -4.22   14.78
filterror =     0.02    1.97    3.92    5.87    7.83    9.78   11.73   13.69

10.2.0.253 configured, authenticated, selected, sane, valid, stratum 5
ref ID 10.2.0.1, time E74D746B.9F292967 (21:02:51.621 JST Wed Dec 21 2022)
our mode active, peer mode active, our poll intvl 256, peer poll intvl 64
root delay 8.18 msec, root disp 27.94, reach 346, sync dist 298.126
delay 12.13 msec, offset -30.2216 msec, dispersion 260.04
precision 2**18, version 3
org time E74D7479.9B4702B0 (21:03:05.606 JST Wed Dec 21 2022)
rcv time E74D7479.A615EB80 (21:03:05.648 JST Wed Dec 21 2022)
xmt time E74D747A.8C874990 (21:03:06.548 JST Wed Dec 21 2022)
filtdelay =    29.51   34.55    0.00   27.34   12.13   31.68   15.85   16.10
filtoffset =  -27.46  -31.60    0.00  -22.00  -30.22   -8.04  -24.32  -32.33
filterror =     0.98    1.95 16000.0    4.56    4.58    4.59    4.61    4.62
```

æ¬¡ã« r2 ã®è¨­å®šã§ã™ã€‚
```
r2#show ntp associations

      address         ref clock     st  when  poll reach  delay  offset    disp
*~10.2.0.1         169.254.169.123   4     7    64  377     7.8   18.06     4.6
 * master (synced), # master (unsynced), + selected, - candidate, ~ configured

r2(config)#ntp peer 10.2.0.254 key 10

r2#show ntp associations

      address         ref clock     st  when  poll reach  delay  offset    disp
*~10.2.0.1         169.254.169.123   4    61   128  377     7.8   16.22     4.6
+~10.2.0.254       10.2.0.1         16    45    64    6    33.9   18.70  7880.4
 * master (synced), # master (unsynced), + selected, - candidate, ~ configured
```

äº’ã„ã«ãƒ”ã‚¢è¨­å®šã‚’çµ‚ãˆã¦ã‹ã‚‰ç¢ºèªã™ã‚‹ã¨ä¸‹è¨˜ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
```
r2#show ntp associations detail
10.2.0.1 configured, authenticated, our_master, sane, valid, stratum 4
ref ID 169.254.169.123, time E74D73A1.B662FE89 (11:59:29.712 UTC Wed Dec 21 2022)
our mode client, peer mode server, our poll intvl 64, peer poll intvl 64
root delay 0.37 msec, root disp 0.43, reach 377, sync dist 13.229
delay 7.81 msec, offset 16.2204 msec, dispersion 8.48
precision 2**25, version 3
org time E74D742B.A3C11C35 (12:01:47.639 UTC Wed Dec 21 2022)
rcv time E74D742B.A0903109 (12:01:47.627 UTC Wed Dec 21 2022)
xmt time E74D742B.9A6DF34B (12:01:47.603 UTC Wed Dec 21 2022)
filtdelay =    23.88   31.97   24.09    7.81   34.48   11.78   11.78    8.67
filtoffset =   24.41   24.04   24.19   16.22   30.97   22.37   21.59   22.03
filterror =     0.02    0.90    1.88    2.40    3.37    4.35    4.36    4.38

10.2.0.254 configured, authenticated, selected, sane, valid, stratum 5
ref ID 10.2.0.1, time E74D73D1.949B86B4 (12:00:17.580 UTC Wed Dec 21 2022)
our mode active, peer mode active, our poll intvl 64, peer poll intvl 128
root delay 12.42 msec, root disp 35.89, reach 17, sync dist 1934.418
delay -7.32 msec, offset 10.6713 msec, dispersion 1888.66
precision 2**18, version 3
org time E74D743A.8C7D97EA (12:02:02.548 UTC Wed Dec 21 2022)
rcv time E74D743A.893D3FA6 (12:02:02.536 UTC Wed Dec 21 2022)
xmt time E74D7439.9A9FF14D (12:02:01.604 UTC Wed Dec 21 2022)
filtdelay =    36.16   -7.32   49.03   33.94    0.00    0.00    0.00    0.00
filtoffset =   30.79   10.67   11.15   18.70    0.00    0.00    0.00    0.00
filterror =     0.03    1.54    3.49    3.49 16000.0 16000.0 16000.0 16000.0
```

è‡ªåˆ†ãŒ peer è¨­å®šã—ã¦ã„ã¦ã€ç›¸æ‰‹å´ãŒ peer è¨­å®šã—ã¦ã„ãªã„ã¨ãã€ä¸‹è¨˜ã®ã‚ˆã†ã« `our mode active, peer mode passive` ã¨ãªã‚Šã¾ã™ã€‚
```
r2#show ntp associations detail | inc our
10.2.0.1 configured, authenticated, our_master, sane, valid, stratum 4
our mode client, peer mode server, our poll intvl 64, peer poll intvl 64
our mode active, peer mode passive, our poll intvl 64, peer poll intvl 256
```

# ACL ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

ä»¥ä¸‹ã®ã‚ˆã†ã« r2 ãŒ r1 ã«åŒæœŸã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã€r1 å´ã«ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’è¨­å®šã—ã¦ã¿ã¾ã™ã€‚
```
r2#sho ntp assoc

      address         ref clock     st  when  poll reach  delay  offset    disp
*~10.2.0.254       10.2.0.1          5    22    64  377    24.1   -3.72     8.6
 * master (synced), # master (unsynced), + selected, - candidate, ~ configured
```

ãƒ›ã‚¹ãƒˆ 10.2.0.253 ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯åˆ¶å¾¡ã‚¯ã‚¨ãƒªã®ã¿è¨±å¯ã—ã¾ã™ã€‚æ™‚åˆ»æä¾›ã¯ã—ãªã„çŠ¶æ…‹ã«ã—ã¾ã™ã€‚
```
r1(config)#access-list 1 permit host 10.2.0.253
r1(config)#ntp access-group query-only 1
```

r2 ã§ r1 ã¨æ™‚åˆ»åŒæœŸã§ããªããªã‚Šã€reach ã®å€¤ãŒæ‚ªåŒ–ã—ã¦ã„ãã¾ã™ã€‚
```
r2#sho ntp assoc

      address         ref clock     st  when  poll reach  delay  offset    disp
*~10.2.0.254       10.2.0.1          5   132    64  374    15.9  -13.71    11.3
 * master (synced), # master (unsynced), + selected, - candidate, ~ configured
```


`ntp access-group` ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®åˆ¶é™ãŒã§ãã¾ã™ã€‚

| å¼•æ•°       | æ™‚åˆ»æä¾› | æ™‚åˆ»åŒæœŸ | åˆ¶å¾¡ã‚¯ã‚¨ãƒª |
| ---- | ---- | ---- | ---- |
| peer       | o        | o        | o          |
| serve      | o        | -    ã€€ã€€| o    ã€€ã€€  |
| serve-only | o        | -    ã€€ã€€| -    ã€€ã€€  |
| query-only | -        | -    ã€€ã€€| o    ã€€ã€€  |


# ã¾ã¨ã‚

éµã«ã‚ˆã‚‹èªè¨¼ã‚„ã€ACLã«ã‚ˆã‚‹åˆ¶å¾¡ãŒã€è€ƒãˆæ–¹ãŒã‚ã‚“ã©ãã•ã„ã¨ã“ã‚ã§ã€æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚
