---
title: "Docker ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’è©¦ã™"
emoji: "ğŸ§®"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["docker"]
published: true
---

# æ¦‚è¦

Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã—ã¦ Dockerã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‚’è©¦ã—ã¾ã™ã€‚

# ç’°å¢ƒ

Raspberry Pi ä¸Šã® KVM ã§ Docker12 ã‚’å‹•ã‹ã—ã€ãã®ä¸­ã§ Docker ã‚’å‹•ã‹ã™ã€‚

# Docker ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

å…¬å¼è¨˜è¼‰ã®é€šã‚Šã€‚

```
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update
```

```
sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
```

```
sudo docker run --rm hello-world
```

# Docker ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’å‹•ã‹ã™

compose.yaml ã‚’ç”¨æ„ã™ã‚‹ã€‚

```: compose.yaml
services:
  # docker run -d -p 5000:5000 -v /work/vol:/var/lib/registry -name registry registry
  registry:                                                                                                                                                                                                          image: registry:latest
    ports:
      - 5000:5000
    volumes:
      - /work/vol:/var/lib/registry
```

ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ã€‚

```
$ sudo docker compose up -d
```
èµ·å‹•ã—ãŸã“ã¨ã‚’ç¢ºèª

```
$ sudo docker compose ps
NAME              IMAGE             COMMAND                  SERVICE    CREATED              STATUS              PORTS
work-registry-1   registry:latest   "/entrypoint.sh /etc_"   registry   About a minute ago   Up About a minute   0.0.0.0:5000->5000/tcp, :::5000->5000/tcp
```


# Push ã—ã¦ã¿ã‚‹

hello-world:latest ã‚’ hello-world:test ã¨ã—ã¦ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥ã—ã¦ã¿ãŸã„ã€‚

```
$ sudo docker images
REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
hello-world   latest    f1f77a0f96b7   9 days ago      5.2kB
registry      latest    d8876582179f   16 months ago   25MB
```

ã‚¿ã‚°ã‚’ä»˜ã‘ã‚‹
```
$ sudo docker tag hello-world:latest localhost:5000/hello-world:test

$ sudo docker images
REPOSITORY                   TAG       IMAGE ID       CREATED         SIZE
hello-world                  latest    f1f77a0f96b7   9 days ago      5.2kB
localhost:5000/hello-world   test      f1f77a0f96b7   9 days ago      5.2kB
registry                     latest    d8876582179f   16 months ago   25MB
```

ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹
```
$ sudo docker push localhost:5000/hello-world:test
The push refers to repository [localhost:5000/hello-world]
98a92b28c9b8: Pushed
test: digest: sha256:d2b712d831f1cc89d997457109d01fb7ca4dd1d39a363d9f2f9426958a0ca44a size: 524
```

ç¢ºèª
```
$ curl http://localhost:5000/v2/_catalog
{"repositories":["hello-world"]}

$ curl http://localhost:5000/v2/hello-world/tags/list
{"name":"hello-world","tags":["test"]}
```

ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª
```
$ du -sh /work/vol
148K    /work/vol

$ find /work/vol -type f -exec ls -l {} \;
-rw-r--r-- 1 root root 71 Jan 31 23:00 /work/vol/docker/registry/v2/repositories/hello-world/_manifests/tags/test/current/link
-rw-r--r-- 1 root root 71 Jan 31 23:00 /work/vol/docker/registry/v2/repositories/hello-world/_manifests/tags/test/index/sha256/d2b712d831f1cc89d997457109d01fb7ca4dd1d39a363d9f2f9426958a0ca44a/link
-rw-r--r-- 1 root root 71 Jan 31 23:00 /work/vol/docker/registry/v2/repositories/hello-world/_manifests/revisions/sha256/d2b712d831f1cc89d997457109d01fb7ca4dd1d39a363d9f2f9426958a0ca44a/link
-rw-r--r-- 1 root root 71 Jan 31 23:00 /work/vol/docker/registry/v2/repositories/hello-world/_layers/sha256/f1f77a0f96b7251d7ef5472705624e2d76db64855b5b121e1cbefe9dc52d0f86/link
-rw-r--r-- 1 root root 71 Jan 31 23:00 /work/vol/docker/registry/v2/repositories/hello-world/_layers/sha256/c9c5fd25a1bdc181cb012bc4fbb1ab272a975728f54064b7ae3ee8e77fd28c46/link
-rw-r--r-- 1 root root 3156 Jan 31 23:00 /work/vol/docker/registry/v2/blobs/sha256/c9/c9c5fd25a1bdc181cb012bc4fbb1ab272a975728f54064b7ae3ee8e77fd28c46/data
-rw-r--r-- 1 root root 524 Jan 31 23:00 /work/vol/docker/registry/v2/blobs/sha256/d2/d2b712d831f1cc89d997457109d01fb7ca4dd1d39a363d9f2f9426958a0ca44a/data
-rw-r--r-- 1 root root 562 Jan 31 23:00 /work/vol/docker/registry/v2/blobs/sha256/f1/f1f77a0f96b7251d7ef5472705624e2d76db64855b5b121e1cbefe9dc52d0f86/data
```

# Pull ã—ã¦ã¿ã‚‹

ã‚¿ã‚°ã‚’ã¤ã‘ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å‰Šé™¤ã™ã‚‹
```
$ sudo docker rmi localhost:5000/hello-world:test
Untagged: localhost:5000/hello-world:test
Untagged: localhost:5000/hello-world@sha256:d2b712d831f1cc89d997457109d01fb7ca4dd1d39a363d9f2f9426958a0ca44a

$ sudo docker images
REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
hello-world   latest    f1f77a0f96b7   10 days ago     5.2kB
registry      latest    d8876582179f   16 months ago   25MB
```


ãƒ—ãƒ«ã™ã‚‹
```
$ sudo docker pull localhost:5000/hello-world:test
test: Pulling from hello-world
Digest: sha256:d2b712d831f1cc89d997457109d01fb7ca4dd1d39a363d9f2f9426958a0ca44a
Status: Downloaded newer image for localhost:5000/hello-world:test
localhost:5000/hello-world:test

$ sudo docker images
REPOSITORY                   TAG       IMAGE ID       CREATED         SIZE
hello-world                  latest    f1f77a0f96b7   10 days ago     5.2kB
localhost:5000/hello-world   test      f1f77a0f96b7   10 days ago     5.2kB
registry                     latest    d8876582179f   16 months ago   25MB
```

# é€šä¿¡ã®ç§˜åŒ¿åŒ–

æœ¬ç¨¿ã§ã¯å‰²æ„›ã™ã‚‹ãŒã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‚’å¤–ã«ãŠã„ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆçµŒç”±ã§åˆ©ç”¨ã™ã‚‹ãªã‚‰ HTTPS åŒ–ã—ãŸã„ã¨ã“ã‚ã€‚
(æ°—ãŒå‘ã„ãŸã‚‰è¿½è¨˜ã™ã‚‹)