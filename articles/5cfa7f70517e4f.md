---
title: "Ubuntu 22.04 ã®ã‚«ãƒ¼ãƒãƒ«ã‚’ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹"
emoji: "ğŸ—"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["azuure", "ubuntu"]
published: true
---

Azureã®ä»®æƒ³ãƒã‚·ãƒ³ã§ã‚«ãƒ¼ãƒãƒ«ã‚’ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã¿ãŸã€‚
è©¦ã—ã¦ã¿ã‚‹å¥‘æ©Ÿã¨ãªã£ãŸã®ã¯ã€[Azure Site Recovery ã§ Mobility Service ãŒå¯¾å¿œã™ã‚‹ã‚«ãƒ¼ãƒãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆ¶é™ãŒã‚ã‚‹ãŸã‚](https://learn.microsoft.com/ja-jp/azure/site-recovery/azure-to-azure-support-matrix)ã€‚
å¯¾å¿œã™ã‚‹ã‚«ãƒ¼ãƒãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ãªã„ã¨ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã«å¤±æ•—ã—ã¦ãƒ‡ã‚£ã‚¶ã‚¹ã‚¿ãƒªã‚«ãƒãƒªè¨­å®šãŒã§ããªã„ã€‚

## å®Ÿæ–½ç’°å¢ƒ

ARMãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ä¸‹è¨˜ã§VMã‚’ç«‹ã¦ãŸç’°å¢ƒã§ãƒ†ã‚¹ãƒˆã—ãŸã€‚
```
                    "imageReference": {
                        "publisher": "canonical",
                        "offer": "0001-com-ubuntu-server-jammy",
                        "sku": "22_04-lts-gen2",
                        "version": "latest"
                    },
```

èµ·å‹•ã—ãŸVMã«å…¥ã‚‹ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ãªçŠ¶æ…‹ã ã£ãŸã€‚
```
$ uname -a
Linux test-vm 6.5.0-1016-azure #16~22.04.1-Ubuntu SMP Fri Feb 16 15:42:02 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux

$ cat /etc/os-release 
PRETTY_NAME="Ubuntu 22.04.4 LTS"
NAME="Ubuntu"
VERSION_ID="22.04"
VERSION="22.04.4 LTS (Jammy Jellyfish)"
VERSION_CODENAME=jammy
ID=ubuntu
ID_LIKE=debian
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
UBUNTU_CODENAME=jammy

$ dpkg -l | grep linux-image
ii  linux-image-6.5.0-1016-azure           6.5.0-1016.16~22.04.1                   amd64        Signed kernel image azure
ii  linux-image-azure                      6.5.0.1016.16~22.04.1                   amd64        Linux kernel image for Azure systems (vmlinuz).
```

ã“ã®ãƒ†ã‚¹ãƒˆå®Ÿæ–½æ™‚ç‚¹ã§ã€ã‚µã‚¤ãƒˆãƒªã‚«ãƒãƒªã‚’è¨­å®šã™ã‚‹ã¨ã€åˆ©ç”¨ã•ã‚Œã‚‹ãƒ¢ãƒ“ãƒªãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯9.60 ã¨ãªã‚Šã€ã“ã‚Œã¯ Ubuntu 22.04 LTS ã® 6.5.0-1016-azure ã«å¯¾å¿œã—ã¦ãŠã‚‰ãšã€ã‚¨ãƒ©ãƒ¼ã¨ãªã£ãŸã€‚

## ã‚«ãƒ¼ãƒãƒ«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½ãªãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’èª¿ã¹ã‚‹

```
$ sudo apt search linux-azure | grep linux-image-6.5.0
```

ã“ã®ãƒ†ã‚¹ãƒˆå®Ÿæ–½æ™‚ç‚¹ã§ã€ãƒ¢ãƒ“ãƒªãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹9.60 ã§å¯¾å¿œã™ã‚‹æœ€æ–°ã‚«ãƒ¼ãƒãƒ«ã¯ Ubuntu 22.04 LTSã§ã¯ 6.5.0-1011-azure ã ã£ãŸã®ã§ã€linux-image-6.5.0-1011-azure ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã«ã™ã‚‹ã€‚

```
$ sudo apt install linux-image-6.5.0-1011-azure                                                                                                                  
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã®çŠ¶æ…‹ã‚’ç¢ºèªã™ã‚‹ã€‚

```
$ dpkg -l | grep linux-image
ii  linux-image-6.5.0-1011-azure           6.5.0-1011.11~22.04.1                   amd64        Signed kernel image azure
ii  linux-image-6.5.0-1016-azure           6.5.0-1016.16~22.04.1                   amd64        Signed kernel image azure
ii  linux-image-azure                      6.5.0.1016.16~22.04.1                   amd64        Linux kernel image for Azure systems (vmlinuz).
```

## ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ã®è¨­å®šå¤‰æ›´

ç‰©ç†ãƒã‚·ãƒ³ã ã¨ã€ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€èµ·å‹•æ™‚ã«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰é¸æŠã—ã¦ã€èµ·å‹•ã™ã‚‹ã‚«ãƒ¼ãƒãƒ«ã‚’é¸æŠã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
IaaSã®ä»®æƒ³ãƒã‚·ãƒ³ã§ã‚‚ã§ãã‚‹ã‹ã‚‚ã—ã‚Œãªã„ãŒã€ã“ã“ã§ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§èµ·å‹•ã™ã‚‹ã‚«ãƒ¼ãƒãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã«ã™ã‚‹ã€‚

```
$ sudo grep menuentry /boot/grub/grub.cfg
if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
  menuentry_id_option=""
export menuentry_id_option
menuentry 'Ubuntu' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-simple-148b82c8-e8e4-4b41-b1ec-36a2eb471071' {
submenu 'Advanced options for Ubuntu' $menuentry_id_option 'gnulinux-advanced-148b82c8-e8e4-4b41-b1ec-36a2eb471071' {
        menuentry 'Ubuntu, with Linux 6.5.0-1016-azure' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-6.5.0-1016-azure-advanced-148b82c8-e8e4-4b41-b1ec-36a2eb471071' {
        menuentry 'Ubuntu, with Linux 6.5.0-1016-azure (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-6.5.0-1016-azure-recovery-148b82c8-e8e4-4b41-b1ec-36a2eb471071' {
        menuentry 'Ubuntu, with Linux 6.5.0-1011-azure' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-6.5.0-1011-azure-advanced-148b82c8-e8e4-4b41-b1ec-36a2eb471071' {
        menuentry 'Ubuntu, with Linux 6.5.0-1011-azure (recovery mode)' --class ubuntu --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-6.5.0-1011-azure-recovery-148b82c8-e8e4-4b41-b1ec-36a2eb471071' {
menuentry 'UEFI Firmware Settings' $menuentry_id_option 'uefi-firmware' {

$ sudo cp -pi /etc/default/grub ~ 

$ diff -u /etc/default/grub ~/grub                                                                                                                               
--- /etc/default/grub   2024-03-19 21:17:11.180950485 +0000
+++ /home/infrauser/grub        2024-03-08 02:14:01.108612555 +0000
@@ -3,7 +3,7 @@
 # For full documentation of the options in this file, see:
 #   info -f grub -n 'Simple configuration'
 
-GRUB_DEFAULT="Advanced options for Ubuntu>Ubuntu, with Linux 6.5.0-1011-azure"
+GRUB_DEFAULT=0
 GRUB_TIMEOUT_STYLE=hidden
 GRUB_TIMEOUT=0
 GRUB_DISTRIBUTOR=`lsb_release -i -s 2> /dev/null || echo Debian`
```

## å†èµ·å‹•ã¨ç¢ºèª

ã‚«ãƒ¼ãƒãƒ«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ã€ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ã®è¨­å®šå¤‰æ›´ã‚’å®Ÿæ–½ã—ãŸã‚‰ã€å†èµ·å‹•ã™ã‚‹ã€‚

```
$ sudo shutdown -r now
```

å†èµ·å‹•ã—ãŸã‚‰ã€ã‚«ãƒ¼ãƒãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤‰æ›´ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚

```
$ uname -a
Linux test-vm 6.5.0-1011-azure #11~22.04.1-Ubuntu SMP Mon Jan 15 16:59:12 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux
```

## ä¸è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å‰Šé™¤

ä¸è¦ãªã‚«ãƒ¼ãƒãƒ«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å‰Šé™¤ã™ã‚‹ã€‚
ã“ã®ã¨ãã€linux-image-azureãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚ä¸€ç·’ã«å‰Šé™¤ã•ã‚ŒãŸã€‚dummy transitional packageã¨æ€ã‚ã‚Œã‚‹ã®ã§ã€å‹•ä½œã«å½±éŸ¿ã¯ãªã„ã ã‚ã†ãŒã€æ°—æŒã¡æ‚ªã‘ã‚Œã°èª¿ã¹ãŸã»ã†ãŒã„ã„ã€‚

```
$ sudo apt remove linux-image-6.5.0-1016-azure 
```

ãã®ä»–ä¸è¦ãªé–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚‚å‰Šé™¤ã™ã‚‹

```
$ sudo apt autoremove
```

çµæœã‚’ç¢ºèªã™ã‚‹

```
$ dpkg -l | grep 6.5.0-1011
ii  linux-image-6.5.0-1011-azure           6.5.0-1011.11~22.04.1                   amd64        Signed kernel image azure
ii  linux-modules-6.5.0-1011-azure         6.5.0-1011.11~22.04.1                   amd64        Linux kernel extra modules for version 6.5.0 on 64 bit x86 SMP
```

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å›ºå®š

ä»Šå¾Œ apt upgrade å®Ÿè¡Œæ™‚ã«å‹æ‰‹ã«ã‚«ãƒ¼ãƒãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸ŠãŒã‚‹ã“ã¨ã®ãªã„ã‚ˆã†ã«ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å›ºå®šã™ã‚‹ã€‚
(ãªãŠã€Azureã®ãƒ¢ãƒ“ãƒªãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã€ã“ã¾ã‚ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚Œã¦ã€å¯¾å¿œã‚«ãƒ¼ãƒãƒ«ã«ã¤ã„ã¦ã®æƒ…å ±ã‚‚æ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã ã€‚æœ¬è¨˜äº‹è¨˜è¼‰æ™‚ç‚¹ã§ã¯ 6.5.0-1015-azure ã¾ã§å¯¾å¿œã—ã¦ã„ãŸã€‚)

```
$ sudo apt-mark hold linux-image-6.5.0-1011-azure linux-modules-6.5.0-1011-azure
linux-image-6.5.0-1011-azure set on hold.
linux-modules-6.5.0-1011-azure set on hold.

$ dpkg --get-selections | grep hold
linux-image-6.5.0-1011-azure                    hold
linux-modules-6.5.0-1011-azure                  hold

$ dpkg -l | grep linux-image
hi  linux-image-6.5.0-1011-azure           6.5.0-1011.11~22.04.1                   amd64        Signed kernel image azure
rc  linux-image-6.5.0-1016-azure           6.5.0-1016.16~22.04.1                   amd64        Signed kernel image azure
```

